import{a as Xe}from"./chunk-E3U3NLLG.js";import{a as K,b as E,c as Q,d as re,e as qe,f as ae,g as se,h as le,i as Ze,j as We,k as ce,l as de,m as pe,n as Ke,o as Qe,p as Y,q as Ye}from"./chunk-MUP63TIL.js";import{a as et}from"./chunk-54KZWHWX.js";import{$ as D,A as g,Aa as oe,B as U,Ba as Je,Ca as H,Da as $e,Ea as Ge,F as m,Fa as R,Ga as P,Ha as I,I as c,Ia as O,J as Fe,K as we,L as o,M as i,N as u,O as Ee,P as Se,Q as M,R as x,S as p,T as Be,U as Me,V as a,W as f,X as b,Y as Re,Z as A,_ as k,a as te,c as De,ca as Ne,e as ee,ea as T,fa as ze,ga as G,ha as Oe,ia as Le,j as Te,n as z,oa as L,p as _,pa as y,q as v,qa as Ve,r as Pe,ra as ie,s as ye,sa as F,ta as je,ua as B,va as V,wa as He,x as S,xa as j,y as s,ya as ne,za as w}from"./chunk-M6YUWBB5.js";import{f as h}from"./chunk-42NE2CY3.js";var me=class n{loadingSubject=new De(!1);loading$=this.loadingSubject.asObservable();show(){this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}static \u0275fac=function(e){return new(e||n)};static \u0275prov=Te({token:n,factory:n.\u0275fac,providedIn:"root"})};function at(n,t){n&1&&(o(0,"div",1)(1,"div",2),u(2,"div",3),o(3,"div",4),a(4,"Cargando..."),i()()())}var ue=class n{constructor(t){this.loaderService=t}static \u0275fac=function(e){return new(e||n)(g(me))};static \u0275cmp=U({type:n,selectors:[["app-loader"]],decls:2,vars:3,consts:[["class","loader-overlay",4,"ngIf"],[1,"loader-overlay"],[1,"loader-content"],[1,"spinner"],[1,"loader-text"]],template:function(e,r){e&1&&(m(0,at,5,0,"div",0),T(1,"async")),e&2&&c("ngIf",ze(1,1,r.loaderService.loading$))},dependencies:[F,y,Ve],styles:[".loader-overlay[_ngcontent-%COMP%]{position:fixed;top:0;left:0;width:100vw;height:100vh;background:#22314a73;z-index:9999;display:flex;align-items:center;justify-content:center}.loader-content[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;gap:1.2rem}.spinner[_ngcontent-%COMP%]{width:56px;height:56px;border:6px solid #e0e0e0;border-top:6px solid #22314a;border-radius:50%;animation:_ngcontent-%COMP%_spin 1s linear infinite}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.loader-text[_ngcontent-%COMP%]{color:#fff;font-size:1.3rem;font-weight:600;text-shadow:0 2px 8px rgba(34,49,74,.15)}"]})};var fe=class n{title="taller-app-frontend";router=z(w);route=z(j);msalService=z(R);userService=z(O);ngOnInit(){let t=this.msalService.instance.getAllAccounts();t.length>0&&this.msalService.instance.setActiveAccount(t[0]);let e=this.msalService.instance.getActiveAccount();if(console.log("\u{1F9D1} Cuenta activa:",e),e)console.log("\u{1F50D} MSAL Account full object:",JSON.stringify(e,null,2)),e.username?console.log("\u2705 Email to be used for registration:",e.username):console.warn("\u26A0\uFE0F MSAL account object does not have username.");else{console.warn("\u26A0\uFE0F No MSAL account found. Redirecting to login."),this.router.navigate(["/login"]);return}this.handlePostRegistrationFlow(e),this.route.queryParamMap.subscribe(r=>{let l=r.get("token");l&&(localStorage.setItem("token",l),this.router.navigate(["/dashboard"]))})}handlePostRegistrationFlow(t){return h(this,null,function*(){console.log("\u{1F504} Iniciando flujo de post-registro para:",t.username);try{let e=yield this.msalService.acquireTokenSilent({scopes:["https://proyectouc.onmicrosoft.com/22c2ec51-5266-40ca-81fe-b40be13e8a23/demo.read"],account:t}).toPromise();if(!e?.accessToken){console.error("\u274C No se obtuvo accessToken.");return}console.log("\u2705 Access Token obtenido exitosamente"),localStorage.setItem("token",e.accessToken);let r=yield this.checkIfUserExists(t),l=t.username||"no-email-found@example.com";if(r)console.log("\u2705 Usuario existente, redirigiendo al dashboard"),this.router.navigate(["/dashboard"]);else{console.log("\u{1F195} Usuario nuevo detectado, redirigiendo a complete-registration"),this.router.navigate(["/complete-registration"],{queryParams:{email:l,name:t.name||""}});return}this.tryCreateUserInBackend(t)}catch(e){console.error("\u274C Error al obtener token de acceso:",e);let r=t.username||"no-email-found@example.com";this.router.navigate(["/complete-registration"],{queryParams:{email:r,name:t.name||""}})}})}tryCreateUserInBackend(t){return h(this,null,function*(){try{if((yield this.checkIfUserExists(t))?console.log("\u2705 Usuario ya existe en backend"):(console.log("\u{1F195} Usuario no existe en backend, creando..."),console.log("Usuario necesita ser creado en el backend:",t.username)),t.username)try{let r=yield this.userService.obtenerRolPorCorreo(t.username);console.log("\u{1F3AD} Rol obtenido en app component:",r)}catch(r){console.error("\u274C Error al obtener rol en app component:",r)}}catch(e){console.error("Error checking/creating user in backend:",e)}})}checkIfUserExists(t){return h(this,null,function*(){try{let e=yield fetch(`${P.apiUrl}/usuarios/correo`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({email:t.username})});return e.ok&&(yield e.json()).exists||!1}catch(e){return console.error("Error checking if user exists:",e),!1}})}static \u0275fac=function(e){return new(e||n)};static \u0275cmp=U({type:n,selectors:[["app-root"]],decls:2,vars:0,template:function(e,r){e&1&&u(0,"app-loader")(1,"router-outlet")},dependencies:[ne,ue],encapsulation:2})};function lt(n,t){if(n&1&&(o(0,"div",11),a(1),i()),n&2){let e=p();s(),f(e.errorMessage)}}var ge=class n{constructor(t,e){this.router=t;this.msalService=e}errorMessage=null;loginWithMicrosoft(){this.msalService.loginRedirect({scopes:["openid","profile","email"],prompt:"login"})}static \u0275fac=function(e){return new(e||n)(g(w),g(R))};static \u0275cmp=U({type:n,selectors:[["app-login"]],decls:17,vars:1,consts:[[1,"login-container"],[1,"image-side"],[1,"form-side"],[1,"login-box"],[1,"logo"],["width","40","height","40","viewBox","0 0 24 24","fill","none","xmlns","http://www.w3.org/2000/svg"],["d","M3 12H6L9 3L15 21L18 12H21","stroke","#1E2A3A","stroke-width","2","stroke-linecap","round","stroke-linejoin","round"],[1,"login-btn",3,"click"],["viewBox","0 0 23 23","xmlns","http://www.w3.org/2000/svg",1,"microsoft-logo"],["d","M11 11H0V0h11v11zm12 0h-9V0h9v11zm-12 12H0V12h11v11zm12 0h-9V12h9v11z","fill","#fff"],["class","alert alert-danger","role","alert",4,"ngIf"],["role","alert",1,"alert","alert-danger"]],template:function(e,r){e&1&&(o(0,"div",0),u(1,"div",1),o(2,"div",2)(3,"div",3)(4,"div",4),Pe(),o(5,"svg",5),u(6,"path",6),i(),ye(),o(7,"h1"),a(8,"TradingThings"),i()(),o(9,"h2"),a(10,"Iniciar sesi\xF3n"),i(),o(11,"button",7),x("click",function(){return r.loginWithMicrosoft()}),Pe(),o(12,"svg",8),u(13,"path",9),i(),ye(),o(14,"span"),a(15,"Iniciar sesi\xF3n con Microsoft"),i()(),m(16,lt,2,1,"div",10),i()()()),e&2&&(s(16),c("ngIf",r.errorMessage))},dependencies:[F,y,H],styles:['@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJbecmNE.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJnecmNE.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJfecg.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_nghost-%COMP%]{font-family:Poppins,sans-serif}.login-container[_ngcontent-%COMP%]{display:flex;height:100vh}.image-side[_ngcontent-%COMP%]{flex:1;background:url("./media/background-BZDSTRBS.png") no-repeat center center/cover}.form-side[_ngcontent-%COMP%]{width:500px;display:flex;justify-content:center;align-items:center;background-color:#f0f2f5}.login-box[_ngcontent-%COMP%]{background:#fff;padding:40px;border-radius:12px;box-shadow:0 4px 20px #0000001a;width:100%;max-width:400px;text-align:center}.logo[_ngcontent-%COMP%]{display:flex;align-items:center;justify-content:center;margin-bottom:20px;gap:10px}.logo[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;font-weight:700;color:#1e2a3a;margin:0}h2[_ngcontent-%COMP%]{font-size:24px;font-weight:600;color:#1e2a3a;margin-bottom:30px}form[_ngcontent-%COMP%]{display:flex;flex-direction:column}.input-group[_ngcontent-%COMP%]{position:relative;margin-bottom:20px}.input-group[_ngcontent-%COMP%]   svg[_ngcontent-%COMP%]{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#9a9a9a;width:20px;height:20px;pointer-events:none}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{width:100%;padding:12px 12px 12px 44px;border:1px solid #e0e0e0;border-radius:8px;font-size:16px;box-sizing:border-box;transition:border-color .3s}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{outline:none;border-color:#1e2a3a}.input-group[_ngcontent-%COMP%]   input.invalid[_ngcontent-%COMP%]{border-color:#d32f2f}.forgot-password[_ngcontent-%COMP%]{display:block;text-align:right;margin-bottom:20px;font-size:14px;color:#1e2a3a;text-decoration:none}.forgot-password[_ngcontent-%COMP%]:hover{text-decoration:underline}button[_ngcontent-%COMP%]{padding:14px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;border:none;margin-bottom:15px;transition:background-color .3s,color .3s}.login-btn[_ngcontent-%COMP%]{background-color:#1e2a3a;color:#fff;display:inline-flex;align-items:center;justify-content:center;gap:12px}.login-btn[_ngcontent-%COMP%]:hover{background-color:#34495e}.register-btn[_ngcontent-%COMP%]{background-color:#fff;color:#1e2a3a;border:1px solid #e0e0e0}.register-btn[_ngcontent-%COMP%]:hover{background-color:#f5f5f5}.microsoft-logo[_ngcontent-%COMP%]{width:18px;height:18px}.error-message[_ngcontent-%COMP%]{color:#d32f2f;font-size:12px;text-align:left;margin-top:-15px;margin-bottom:15px}']})};function ct(n,t){n&1&&(o(0,"div",2),u(1,"div",3),o(2,"p"),a(3,"Cargando..."),i()())}function dt(n,t){n&1&&(o(0,"li")(1,"a",36),a(2,"Listado de usuarios"),i()())}function pt(n,t){n&1&&(o(0,"li")(1,"a",37),a(2,"Listado de productos"),i()())}function mt(n,t){n&1&&(o(0,"li")(1,"a",38),a(2,"Mis productos"),i()())}function ut(n,t){if(n&1&&(o(0,"span",39),a(1),i()),n&2){let e=p(2);s(),f(e.notificacionesIntercambio)}}function ft(n,t){if(n&1&&(o(0,"div")(1,"p")(2,"strong"),a(3,"Nombre:"),i(),a(4),i(),o(5,"p")(6,"strong"),a(7,"Correo:"),i(),a(8),i(),o(9,"p")(10,"strong"),a(11,"Usuario:"),i(),a(12),i(),o(13,"p")(14,"strong"),a(15,"Rol:"),i(),a(16),i(),o(17,"p")(18,"strong"),a(19,"Estado:"),i(),a(20),i()()),n&2){let e=p(3);s(4),Re(" ",e.usuario.primerNombre," ",e.usuario.segundoNombre," ",e.usuario.apellidoPaterno," ",e.usuario.apellidoMaterno,""),s(4),b(" ",e.usuario.correo,""),s(4),b(" ",e.usuario.usuario,""),s(4),b(" ",e.usuario.rol.nombre,""),s(4),b(" ",e.usuario.estado.estado,"")}}function gt(n,t){if(n&1){let e=M();o(0,"div",40)(1,"div",41)(2,"h3"),a(3,"Datos del usuario"),i(),m(4,ft,21,8,"div",1),o(5,"button",42),x("click",function(){_(e);let l=p(2);return v(l.closeUserModal())}),a(6,"Cerrar"),i()()()}if(n&2){let e=p(2);s(4),c("ngIf",e.usuario)}}function bt(n,t){if(n&1){let e=M();o(0,"div")(1,"div",4)(2,"h1",5),a(3),i(),o(4,"aside",6)(5,"div",7)(6,"a",8),x("click",function(){_(e);let l=p();return v(l.navigateToDashboard())}),o(7,"span",9),a(8,"\u2714\uFE0F"),i(),o(9,"span",10),a(10,"TradingThings"),i()()(),o(11,"ul",11)(12,"li")(13,"span",12),a(14,"\u{1F464}"),i(),a(15),i()(),o(16,"div",13)(17,"nav")(18,"ul")(19,"li")(20,"a",14),x("click",function(){_(e);let l=p();return v(l.navigateToDashboard())}),a(21,"Home"),i()(),m(22,dt,3,0,"li",1)(23,pt,3,0,"li",1),o(24,"li")(25,"a",15),a(26,"Publicar productos"),i()(),m(27,mt,3,0,"li",1),o(28,"li")(29,"a",16),a(30,"\u{1F504} Intercambios"),i()(),o(31,"li")(32,"a",17),a(33,"\u2705 Confirmar Intercambios"),i()(),o(34,"li")(35,"a",18),a(36,"Mi cuenta"),i()(),o(37,"li")(38,"a",19),a(39,"Ayuda"),i()(),o(40,"li")(41,"a",20),x("click",function(){_(e);let l=p();return v(l.logout())}),a(42,"Cerrar Sesi\xF3n"),i()()()(),o(43,"div",21)(44,"span"),u(45,"i",22),i(),o(46,"span"),u(47,"i",23),i(),o(48,"span"),u(49,"i",24),i(),o(50,"span"),u(51,"i",25),i()()(),u(52,"div",26),i(),o(53,"div",27)(54,"header",28)(55,"div",29)(56,"h2"),a(57),i()(),o(58,"div",30)(59,"span",31),u(60,"i",32),m(61,ut,2,1,"span",33),i(),o(62,"span",34),x("click",function(){_(e);let l=p();return v(l.openUserModal())}),a(63),i()()(),m(64,gt,7,1,"div",35),u(65,"router-outlet"),i()()()}if(n&2){let e=p();s(3),f(e.title),s(12),b(" ",e.getRoleLabel(),""),s(7),c("ngIf",e.isAdmin()),s(),c("ngIf",e.isAdmin()),s(4),c("ngIf",!e.isAdmin()),s(30),b("Bienvenido, ",e.username,"!"),s(4),c("ngIf",e.notificacionesIntercambio>0),s(2),b(" ",e.getRoleLabel()," "),s(),c("ngIf",e.showUserModal)}}function tt(n){return n&&typeof n=="object"&&"id"in n}var be=class n{constructor(t,e,r,l,d,C,$){this.route=t;this.router=e;this.authService=r;this.userService=l;this.msalService=d;this.cdr=C;this.http=$}title="Dashboard";username="Invitado";userRole=null;userEmail="";subscriptions=new te;rolSub=null;showUserModal=!1;usuario=null;cargandoRol=!0;notificacionesIntercambio=3;ngOnInit(){this.subscriptions.add(this.userService.rolUsuario$.subscribe(t=>{this.userRole=t,this.cdr.detectChanges(),this.userRole!==null&&(this.cargandoRol=!1),this.userRole!==null&&this.isAdmin()&&this.router.url!=="/dashboard/usuarios"?(console.log("[Dashboard] Es admin, forzando redirecci\xF3n a /dashboard/usuarios"),this.router.navigate(["/dashboard/usuarios"])):this.userRole!==null&&!this.isAdmin()&&this.router.url==="/dashboard"&&(console.log("[Dashboard] No es admin, redirigiendo a /dashboard/todos-los-productos"),this.router.navigate(["/dashboard/todos-los-productos"]))})),this.subscriptions.add(this.userService.userName$.subscribe(t=>{this.username=t,this.cdr.detectChanges()})),this.subscriptions.add(this.userService.userEmail$.subscribe(t=>{this.userEmail=t,this.cdr.detectChanges()})),this.rolSub=this.userService.rolUsuario$.subscribe(t=>{this.userRole=t,this.cdr.detectChanges(),this.router.url==="/dashboard"&&(this.isAdmin()?this.router.navigate(["/dashboard/usuarios"]):this.router.navigate(["/dashboard/todos-los-productos"]))}),this.route.queryParams.subscribe(t=>{let e=t.token;e&&(console.log("Dashboard: Token found in query params, storing it"),this.authService.setToken(e),this.router.navigate(["/dashboard"],{queryParams:{},replaceUrl:!0}))}),this.updateUserInfo()}cargarNotificacionesIntercambio(){return h(this,null,function*(){try{console.log("Cargando notificaciones de intercambio...");let t=null;if(this.usuario&&this.usuario.id)t=this.usuario.id,console.log("Usuario ID desde this.usuario:",t);else{let d=localStorage.getItem("userId");d&&(t=Number(d)),console.log("Usuario ID desde localStorage:",t)}if(!t){console.log("No se pudo obtener userId, saliendo...");return}let e=localStorage.getItem("token"),r=e?{headers:new B({Authorization:`Bearer ${e}`})}:{};console.log("Llamando a:",`${P.publicacionesApiUrl}/intercambios/ofertas-recibidas/${t}`);let l=(yield this.http.get(`${P.publicacionesApiUrl}/intercambios/ofertas-recibidas/${t}`,r).toPromise())||[];console.log("Respuesta del servidor:",l),this.notificacionesIntercambio=l.filter(d=>d.estadoIntercambio==="PENDIENTE").length,console.log("Notificaciones pendientes:",this.notificacionesIntercambio),this.cdr.detectChanges()}catch(t){console.error("Error al cargar notificaciones:",t),this.notificacionesIntercambio=0}})}ngOnDestroy(){this.subscriptions.unsubscribe(),this.rolSub?.unsubscribe()}updateUserInfo(){return h(this,null,function*(){if(this.authService.isLoggedIn()){let t=this.userService.getUserEmailFromMSAL();this.userService.setUserEmail(t),this.userEmail=t;let e=null,r=null;if(console.log("DASHBOARD: email usado para buscar usuario:",t),t)try{e=yield this.userService.getUsuarioPorCorreo(t),this.usuario=e,console.log("DASHBOARD: usuario obtenido por correo:",e),e&&e.id&&(r=e.id,localStorage.setItem("userId",r.toString()))}catch(C){e=null,this.usuario=null,console.error("DASHBOARD: error al obtener usuario por correo:",C)}let l=localStorage.getItem("userId");if(console.log("DASHBOARD: userId en localStorage:",l),!e&&l){let C=Number(l);try{e=yield this.userService.getUsuarioPorId(C),console.log("DASHBOARD: usuario obtenido por ID:",e)}catch($){e=null,console.error("DASHBOARD: error al obtener usuario por ID:",$)}}let d="";e?e.primerNombre&&e.apellidoPaterno?d=`${e.primerNombre} ${e.apellidoPaterno}`:e.primerNombre?d=e.primerNombre:e.apellidoPaterno?d=e.apellidoPaterno:e.correo?d=e.correo:d="Invitado":d=t||"Invitado",this.username=d,this.userService.setUserName(d),console.log("DASHBOARD: nombre final asignado:",d);try{let C=yield this.userService.obtenerRolPorCorreo(t);console.log("DASHBOARD: backendRole =",C,typeof C)}catch{this.userService.setRol(null)}yield this.cargarNotificacionesIntercambio()}else this.username="Invitado",this.userService.setUserName("Invitado"),this.authService.logout()})}logout(){this.authService.logout(),this.userService.clearRol(),window.location.href="/"}getRoleLabel(){let t=this.userRole;return tt(this.userRole)&&(t=this.userRole.id),t===1?"Administrador":t===2?"Usuario":"Sin rol asignado"}isAdmin(){return tt(this.userRole)?this.userRole.id===1:this.userRole===1}hasActiveChildRoute(){return this.router.url!=="/dashboard"}navigateToDashboard(){this.isAdmin()?this.router.navigate(["/dashboard/usuarios"]):this.router.navigate(["/dashboard/todos-los-productos"])}openUserModal(){this.showUserModal=!0}closeUserModal(){this.showUserModal=!1}static \u0275fac=function(e){return new(e||n)(g(j),g(w),g(I),g(O),g(R),g(Le),g(V))};static \u0275cmp=U({type:n,selectors:[["app-dashboard"]],decls:2,vars:2,consts:[["class","loader-container",4,"ngIf"],[4,"ngIf"],[1,"loader-container"],[1,"spinner"],[1,"dashboard-layout"],[1,"hidden-title"],[1,"sidebar"],[1,"logo-area"],["routerLink","/dashboard",2,"text-decoration","none","color","inherit","display","flex","align-items","center",3,"click"],[1,"logo-icon"],[1,"logo-text"],[1,"user-list"],[1,"user-icon"],[1,"sidebar-links"],["routerLink","/dashboard",3,"click"],["routerLink","/dashboard/publicar-producto"],["routerLink","/dashboard/intercambios"],["routerLink","/dashboard/confirmar-intercambios"],["routerLink","/mi-cuenta"],["routerLink","/ayuda"],["routerLink","/ayuda",3,"click"],[1,"social-icons"],[1,"fa","fa-facebook"],[1,"fa","fa-instagram"],[1,"fa","fa-twitter"],[1,"fa","fa-phone"],[1,"sidebar-footer"],[1,"main-content"],[1,"main-header"],[1,"welcome-message"],[1,"user-info",2,"position","relative"],[1,"user-avatar",2,"position","relative"],[1,"fa","fa-user"],["class","notificacion-badge",4,"ngIf"],[1,"user-link",2,"cursor","pointer","color","white","font-weight","bold",3,"click"],["class","user-modal-overlay",4,"ngIf"],["routerLink","/dashboard/usuarios"],["routerLink","/dashboard/todos-los-productos"],["routerLink","/dashboard/mis-productos"],[1,"notificacion-badge"],[1,"user-modal-overlay"],[1,"user-modal-box"],[2,"background","#1976d2","color","white","border","none","padding","8px 16px","border-radius","4px","margin-top","10px",3,"click"]],template:function(e,r){e&1&&m(0,ct,4,0,"div",0)(1,bt,66,9,"div",1),e&2&&(c("ngIf",r.cargandoRol),s(),c("ngIf",!r.cargandoRol))},dependencies:[F,y,H,ne,oe],styles:['@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJbecmNE.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJnecmNE.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJfecg.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_nghost-%COMP%]{font-family:Poppins,sans-serif}.dashboard-layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f8f9fb}.sidebar[_ngcontent-%COMP%]{width:220px;background:#22314a;color:#fff;display:flex;flex-direction:column;justify-content:space-between;padding:24px 0 0}.logo-area[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:1.5rem;font-weight:700;padding:0 24px 32px;gap:10px}.logo-icon[_ngcontent-%COMP%]{font-size:1.6rem}.logo-text[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;letter-spacing:.5px}.user-list[_ngcontent-%COMP%]{list-style:none;padding:0 24px;margin:0 0 32px}.user-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:1rem;margin-bottom:18px}.user-icon[_ngcontent-%COMP%]{font-size:1.1rem}.user-role[_ngcontent-%COMP%]{font-size:.9rem;opacity:.8;margin-left:20px}.sidebar-footer[_ngcontent-%COMP%]{margin-top:auto;padding:0 24px 24px}.social-icons[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:10px}.social-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem;color:#fff;opacity:.8}.phone[_ngcontent-%COMP%]{font-size:.95rem;color:#fff;opacity:.9;margin-bottom:16px}.logout-btn[_ngcontent-%COMP%]{background:#dc3545;color:#fff;border:none;border-radius:6px;padding:8px 16px;font-size:.9rem;font-weight:500;cursor:pointer;transition:background .2s;width:100%;display:flex;align-items:center;justify-content:center;gap:8px}.logout-btn[_ngcontent-%COMP%]:hover{background:#c82333}.logout-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:#f8f9fb}.main-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:#22314a;color:#fff;padding:18px 32px;font-size:1.1rem;font-weight:500}.welcome-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1.4rem;font-weight:600}.welcome-message[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:0;font-size:.9rem;opacity:.8}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.user-avatar[_ngcontent-%COMP%]{background:#fff;color:#22314a;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}.user-number[_ngcontent-%COMP%]{background:#fff;color:#22314a;border-radius:50%;width:24px;height:24px;display:flex;align-items:center;justify-content:center;font-size:1rem;font-weight:600}.publish-btn-area[_ngcontent-%COMP%]{display:flex;justify-content:center;margin:32px 0 24px}.publish-btn[_ngcontent-%COMP%]{background:#22314a;color:#fff;border:none;border-radius:8px;padding:12px 32px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:background .2s}.publish-btn[_ngcontent-%COMP%]:hover{background:#1a2536}.products-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:32px;padding:0 32px 32px}.product-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #22314a12;display:flex;flex-direction:column;align-items:center;padding:18px 12px 20px;transition:box-shadow .2s}.product-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #22314a21}.product-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:110px;object-fit:cover;border-radius:8px;margin-bottom:16px}.product-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin-bottom:12px;color:#22314a}.see-more-btn[_ngcontent-%COMP%]{display:block;width:100%;background:#22314a;color:#fff;border:none;border-radius:8px;padding:12px 0;font-size:1.1rem;font-weight:600;cursor:pointer;text-align:center;margin-top:1rem;text-decoration:none;transition:background .2s}.see-more-btn[_ngcontent-%COMP%]:hover{background:#1a2536;color:#fff;text-decoration:none}@media (max-width: 900px){.dashboard-layout[_ngcontent-%COMP%]{flex-direction:column}.sidebar[_ngcontent-%COMP%]{width:100%;flex-direction:row;align-items:flex-start;padding:0}.main-content[_ngcontent-%COMP%]{padding:0}.products-grid[_ngcontent-%COMP%]{grid-template-columns:1fr 1fr;padding:0 12px 24px}.main-header[_ngcontent-%COMP%]{flex-direction:column;gap:12px;text-align:center}.welcome-message[_ngcontent-%COMP%]{text-align:center}}@media (max-width: 600px){.products-grid[_ngcontent-%COMP%]{grid-template-columns:1fr}.main-header[_ngcontent-%COMP%]{padding:12px 16px}.publish-btn-area[_ngcontent-%COMP%]{margin:16px 0 12px}}.hidden-title[_ngcontent-%COMP%]{display:none}.sidebar-links[_ngcontent-%COMP%]{border-radius:8px;margin:0 24px 32px;padding:0;background:transparent}.sidebar-links[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:16px}.sidebar-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;font-weight:500;font-size:1rem;transition:color .2s}.sidebar-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#3ee14b}.products-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;justify-content:center;gap:2rem;max-width:900px;margin:2rem auto}.product-card[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 8px #00000014;padding:1.5rem 2rem;min-width:250px;max-width:350px;flex:1 1 300px;display:flex;flex-direction:column;align-items:center;transition:box-shadow .2s}.product-card[_ngcontent-%COMP%]:hover{box-shadow:0 4px 16px #00000026}.product-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600;margin:1rem 0;text-align:center}.see-more-btn[_ngcontent-%COMP%]{background:#22304a;color:#fff;border:none;border-radius:6px;padding:.5rem 1.2rem;margin-top:1rem;text-decoration:none;font-weight:500;transition:background .2s}.see-more-btn[_ngcontent-%COMP%]:hover{background:#1a2333}.product-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:180px;max-height:180px;border-radius:8px;margin-bottom:1rem;object-fit:cover}.user-modal-overlay[_ngcontent-%COMP%]{position:fixed;inset:0;background:#0000004d;display:flex;align-items:center;justify-content:center;z-index:1000}.user-modal-box[_ngcontent-%COMP%]{background:#1976d2;color:#fff;padding:2rem 2.5rem;border-radius:12px;box-shadow:0 4px 24px #0000002e;min-width:320px;max-width:90vw}.user-modal-box[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin-top:0;margin-bottom:1rem;color:#fff}.user-modal-box[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.5rem 0}.user-modal-box[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{margin-top:1rem;font-size:1rem;cursor:pointer}.loader-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:300px}.spinner[_ngcontent-%COMP%]{border:8px solid #f3f3f3;border-top:8px solid #1976d2;border-radius:50%;width:60px;height:60px;animation:_ngcontent-%COMP%_spin 1s linear infinite;margin-bottom:10px}@keyframes _ngcontent-%COMP%_spin{0%{transform:rotate(0)}to{transform:rotate(360deg)}}.notificacion-badge[_ngcontent-%COMP%]{position:absolute;top:-6px;right:-6px;background:#d32f2f;color:#fff;border-radius:50%;padding:2px 6px;font-size:12px;font-weight:700;border:2px solid white;min-width:20px;min-height:20px;display:flex;align-items:center;justify-content:center;box-shadow:0 0 0 2px #fff;z-index:2}']})};var ke=()=>{let n=z(w);return z(I).isLoggedIn()?!0:(console.log("AuthGuard: User not authenticated, redirecting to login"),n.navigate(["/login"]),!1)};function xt(n,t){if(n&1&&(o(0,"option",43),a(1),i()),n&2){let e=t.$implicit;c("value",e.id),s(),b(" ",e.nombre," ")}}function _t(n,t){n&1&&(o(0,"span"),a(1,"La regi\xF3n es obligatoria."),i())}function vt(n,t){if(n&1&&(o(0,"div",44),m(1,_t,2,0,"span",45),i()),n&2){let e,r=p();s(),c("ngIf",(e=r.registrationForm.get("idRegion"))==null||e.errors==null?null:e.errors.required)}}function ht(n,t){if(n&1&&(o(0,"option",43),a(1),i()),n&2){let e=t.$implicit;c("value",e.id),s(),b(" ",e.nombre," ")}}function Ct(n,t){n&1&&(o(0,"span"),a(1,"La provincia es obligatoria."),i())}function Ut(n,t){if(n&1&&(o(0,"div",44),m(1,Ct,2,0,"span",45),i()),n&2){let e,r=p();s(),c("ngIf",(e=r.registrationForm.get("idProvincia"))==null||e.errors==null?null:e.errors.required)}}function Pt(n,t){if(n&1&&(o(0,"option",43),a(1),i()),n&2){let e=t.$implicit;c("value",e.id),s(),b(" ",e.nombre," ")}}function yt(n,t){n&1&&(o(0,"span"),a(1,"La comuna es obligatoria."),i())}function Ft(n,t){if(n&1&&(o(0,"div",44),m(1,yt,2,0,"span",45),i()),n&2){let e,r=p();s(),c("ngIf",(e=r.registrationForm.get("idComuna"))==null||e.errors==null?null:e.errors.required)}}function wt(n,t){n&1&&(o(0,"span"),a(1,"El n\xFAmero de contacto es obligatorio."),i())}function Et(n,t){n&1&&(o(0,"span"),a(1,"Solo se permiten n\xFAmeros."),i())}function St(n,t){if(n&1&&(o(0,"div",44),m(1,wt,2,0,"span",45)(2,Et,2,0,"span",45),i()),n&2){let e,r,l=p();s(),c("ngIf",(e=l.registrationForm.get("numeroContacto"))==null||e.errors==null?null:e.errors.required),s(),c("ngIf",(r=l.registrationForm.get("numeroContacto"))==null||r.errors==null?null:r.errors.pattern)}}function Mt(n,t){if(n&1&&(o(0,"div",46),a(1),i()),n&2){let e=p();s(),b(" ",e.selectedFile.name," ")}}function Ot(n,t){if(n&1&&(o(0,"div",47),a(1),i()),n&2){let e=p();s(),f(e.fileError)}}function It(n,t){n&1&&(o(0,"div",48),u(1,"i",49),a(2," Cargando datos geogr\xE1ficos... "),i())}function At(n,t){if(n&1&&(o(0,"div",50),a(1),i()),n&2){let e=p();s(),f(e.successMessage)}}function kt(n,t){if(n&1&&(o(0,"div",47),a(1),i()),n&2){let e=p();s(),f(e.errorMessage)}}var _e=class n{constructor(t,e,r,l,d,C){this.fb=t;this.route=e;this.router=r;this.http=l;this.authService=d;this.geografiaService=C;this.registrationForm=this.fb.group({rut:["",E.required],primerNombre:["",E.required],segundoNombre:[""],apellidoPaterno:["",E.required],apellidoMaterno:["",E.required],direccion:["",E.required],usuario:["",E.required],numeroContacto:["",[E.required,E.pattern("^[0-9]+$")]],correo:[{value:"",disabled:!0},[E.required,E.email]],idRegion:["",E.required],idProvincia:["",E.required],idComuna:["",E.required],idComunidad:[3]})}registrationForm;errorMessage=null;successMessage=null;isSubmitting=!1;selectedFile=null;fileError=null;regiones=[];provincias=[];comunas=[];isLoadingGeografia=!1;ngOnInit(){this.cargarRegiones(),this.setupGeografiaListeners(),this.route.queryParams.subscribe(t=>{let e=t.email,r=t.name||"",l=t.token;console.log("Complete Registration: Received params:",{email:e,name:r,hasToken:!!l}),l&&(console.log("Complete Registration: Token found in query params, storing it"),this.authService.setToken(l)),this.registrationForm.patchValue({correo:e,primerNombre:r.split(" ")[0]||"",apellidoPaterno:r.split(" ").slice(1).join(" ")||""});let d=r.split(" ");this.registrationForm.patchValue({correo:e,primerNombre:d[0]||"",segundoNombre:d.length>2?d[1]:"",apellidoPaterno:d.length>1?d.length>2?d[2]:d[1]:""})})}cargarRegiones(){return h(this,null,function*(){try{this.isLoadingGeografia=!0,this.regiones=yield ee(this.geografiaService.getRegiones()),console.log("Regiones cargadas:",this.regiones)}catch(t){console.error("Error cargando regiones:",t),this.errorMessage="Error al cargar las regiones. Por favor, recarga la p\xE1gina."}finally{this.isLoadingGeografia=!1}})}setupGeografiaListeners(){this.registrationForm.get("idRegion")?.valueChanges.subscribe(t=>{t&&(this.cargarProvincias(t),this.registrationForm.patchValue({idProvincia:"",idComuna:""}),this.provincias=[],this.comunas=[])}),this.registrationForm.get("idProvincia")?.valueChanges.subscribe(t=>{t&&(this.cargarComunas(t),this.registrationForm.patchValue({idComuna:""}),this.comunas=[])})}cargarProvincias(t){return h(this,null,function*(){try{this.isLoadingGeografia=!0,this.provincias=yield ee(this.geografiaService.getProvinciasPorRegion(t)),console.log("Provincias cargadas para regi\xF3n",t,":",this.provincias)}catch(e){console.error("Error cargando provincias:",e),this.errorMessage="Error al cargar las provincias."}finally{this.isLoadingGeografia=!1}})}cargarComunas(t){return h(this,null,function*(){try{this.isLoadingGeografia=!0,this.comunas=yield ee(this.geografiaService.getComunasPorProvincia(t)),console.log("Comunas cargadas para provincia",t,":",this.comunas)}catch(e){console.error("Error cargando comunas:",e),this.errorMessage="Error al cargar las comunas."}finally{this.isLoadingGeografia=!1}})}resetFormState(){this.isSubmitting=!1,this.errorMessage=null,this.successMessage=null,this.selectedFile=null,this.fileError=null,this.registrationForm.enable(),this.registrationForm.get("correo")?.disable()}onFileSelected(t){let e=t.target;if(e.files&&e.files.length>0){let r=e.files[0],l=r.type;l.startsWith("image/")||l==="application/pdf"?(this.selectedFile=r,this.fileError=null,console.log("Selected file:",{name:r.name,size:r.size,type:r.type,lastModified:r.lastModified})):(this.selectedFile=null,this.fileError="Por favor, selecciona un archivo PDF o una imagen.")}}testRequestFormat(){let t=new FormData;t.append("testField","testValue"),this.selectedFile&&t.append("file",this.selectedFile,this.selectedFile.name),console.log("=== REQUEST DEBUG INFO ==="),console.log("FormData entries:");for(let[r,l]of t.entries())console.log(`${r}:`,l);let e=this.http.post(`${P.apiUrl}/registro-completo`,t);console.log("Request object:",e),console.log("=== CHECK BROWSER NETWORK TAB ==="),console.log("1. Open DevTools (F12)"),console.log("2. Go to Network tab"),console.log("3. Submit the form"),console.log("4. Look for the request to /api/registro-completo"),console.log("5. Check that Content-Type is: multipart/form-data; boundary=..."),console.log("6. The boundary should be automatically generated by the browser")}onSubmit(){return h(this,null,function*(){if(!this.selectedFile){this.fileError="Debes subir una prueba de direcci\xF3n (PDF o imagen) para completar el registro.",this.registrationForm.markAllAsTouched();return}if(this.registrationForm.valid&&!this.isSubmitting){this.isSubmitting=!0,this.errorMessage=null;try{let t=new FormData,e=this.registrationForm.getRawValue();Object.keys(e).forEach(d=>{t.append(d,e[d])}),t.append("rol",JSON.stringify({id:2})),t.append("estado",JSON.stringify({id:1})),t.append("proveedorAutenticacion","azure"),this.selectedFile&&t.append("file",this.selectedFile,this.selectedFile.name);let r=this.authService.getToken(),l=yield ee(this.http.post(`${P.apiUrl}/registro-completo`,t,{headers:r?{Authorization:`Bearer ${r}`}:{}}));console.log("Registration successful:",l),l&&l.token?(this.authService.setToken(l.token),console.log("JWT token stored successfully"),this.successMessage="\xA1Registro completado! Ser\xE1s redirigido al dashboard.",this.registrationForm.disable(),setTimeout(()=>this.router.navigate(["/dashboard"]),2e3)):(console.error("No token received in response:",l),this.errorMessage="Error: No se recibi\xF3 el token de autenticaci\xF3n. Por favor, contacta al administrador.",this.isSubmitting=!1)}catch(t){if(console.error("Registration error:",t),t.status===0)this.errorMessage="Error de conexi\xF3n: No se pudo conectar al servidor.";else if(t.status===400){let e=t.error||"Error desconocido";e.includes("RUT ya existe")?this.errorMessage="El RUT ingresado ya est\xE1 registrado en el sistema.":e.includes("correo electr\xF3nico ya est\xE1 registrado")?this.errorMessage="El correo electr\xF3nico ya est\xE1 registrado.":e.includes("nombre de usuario ya est\xE1 en uso")?this.errorMessage="El nombre de usuario ya est\xE1 en uso. Por favor, elige otro.":this.errorMessage=e}else t.status===413?this.errorMessage="El archivo es demasiado grande.":t.status===415?this.errorMessage="Tipo de archivo no soportado.":t.status>=500?this.errorMessage="Error del servidor. Int\xE9ntalo de nuevo m\xE1s tarde.":this.errorMessage=t.error?.message||"Hubo un error al completar el registro."}finally{this.isSubmitting=!1}}else this.isSubmitting?console.log("Form submission already in progress, ignoring duplicate request"):this.registrationForm.markAllAsTouched()})}static \u0275fac=function(e){return new(e||n)(g(Qe),g(j),g(w),g(V),g(I),g(Xe))};static \u0275cmp=U({type:n,selectors:[["app-complete-registration"]],decls:87,vars:27,consts:[[1,"form-container"],[3,"ngSubmit","formGroup"],[1,"input-group"],["for","correo"],["id","correo","type","email","formControlName","correo","readonly",""],["for","rut"],["id","rut","type","text","formControlName","rut","placeholder","Ej: 12345678-9",3,"disabled"],[1,"row"],["for","primerNombre"],["id","primerNombre","type","text","formControlName","primerNombre",3,"disabled"],["for","apellidoPaterno"],["id","apellidoPaterno","type","text","formControlName","apellidoPaterno",3,"disabled"],["for","segundoNombre"],["id","segundoNombre","type","text","formControlName","segundoNombre",3,"disabled"],["for","apellidoMaterno"],["id","apellidoMaterno","type","text","formControlName","apellidoMaterno",3,"disabled"],["for","direccion"],["id","direccion","type","text","formControlName","direccion",3,"disabled"],["for","idRegion"],["id","idRegion","formControlName","idRegion",3,"disabled"],["value",""],[3,"value",4,"ngFor","ngForOf"],["class","alert alert-danger mt-2 p-2","role","alert",4,"ngIf"],["for","idProvincia"],["id","idProvincia","formControlName","idProvincia",3,"disabled"],["for","idComuna"],["id","idComuna","formControlName","idComuna",3,"disabled"],[1,"input-group",2,"display","none"],["for","idComunidad"],["id","idComunidad","type","hidden","formControlName","idComunidad","value","3"],["for","usuario"],["id","usuario","type","text","formControlName","usuario","placeholder","Crea un alias \xFAnico",3,"disabled"],["for","numeroContacto"],["id","numeroContacto","type","text","formControlName","numeroContacto","placeholder","Ej: 987654321",3,"disabled"],[1,"file-upload"],["for","contractFile",1,"file-label"],[1,"fa","fa-upload"],["type","file","id","contractFile","accept",".pdf,image/*",1,"file-input",3,"change","disabled"],["class","file-name",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],["class","alert alert-info","role","alert",4,"ngIf"],["class","alert alert-success","role","alert",4,"ngIf"],["type","submit",3,"disabled"],[3,"value"],["role","alert",1,"alert","alert-danger","mt-2","p-2"],[4,"ngIf"],[1,"file-name"],["role","alert",1,"alert","alert-danger"],["role","alert",1,"alert","alert-info"],[1,"fa","fa-spinner","fa-spin"],["role","alert",1,"alert","alert-success"]],template:function(e,r){if(e&1&&(o(0,"div",0)(1,"h2"),a(2,"Completar Registro"),i(),o(3,"p"),a(4,"\xA1Casi listo! Solo necesitamos algunos detalles m\xE1s para completar tu perfil."),i(),o(5,"form",1),x("ngSubmit",function(){return r.onSubmit()}),o(6,"div",2)(7,"label",3),a(8,"Correo Electr\xF3nico"),i(),u(9,"input",4),i(),o(10,"div",2)(11,"label",5),a(12,"RUT"),i(),u(13,"input",6),i(),o(14,"div",7)(15,"div",2)(16,"label",8),a(17,"Primer Nombre"),i(),u(18,"input",9),i(),o(19,"div",2)(20,"label",10),a(21,"Apellido Paterno"),i(),u(22,"input",11),i()(),o(23,"div",7)(24,"div",2)(25,"label",12),a(26,"Segundo Nombre (Opcional)"),i(),u(27,"input",13),i(),o(28,"div",2)(29,"label",14),a(30,"Apellido Materno"),i(),u(31,"input",15),i()(),o(32,"div",2)(33,"label",16),a(34,"Direcci\xF3n"),i(),u(35,"input",17),i(),o(36,"div",7)(37,"div",2)(38,"label",18),a(39,"Regi\xF3n *"),i(),o(40,"select",19)(41,"option",20),a(42,"Selecciona una regi\xF3n"),i(),m(43,xt,2,2,"option",21),i(),m(44,vt,2,1,"div",22),i(),o(45,"div",2)(46,"label",23),a(47,"Provincia *"),i(),o(48,"select",24)(49,"option",20),a(50,"Selecciona una provincia"),i(),m(51,ht,2,2,"option",21),i(),m(52,Ut,2,1,"div",22),i()(),o(53,"div",7)(54,"div",2)(55,"label",25),a(56,"Comuna *"),i(),o(57,"select",26)(58,"option",20),a(59,"Selecciona una comuna"),i(),m(60,Pt,2,2,"option",21),i(),m(61,Ft,2,1,"div",22),i(),o(62,"div",27)(63,"label",28),a(64,"Comunidad"),i(),u(65,"input",29),i()(),o(66,"div",2)(67,"label",30),a(68,"Nombre de Usuario"),i(),u(69,"input",31),i(),o(70,"div",2)(71,"label",32),a(72,"N\xFAmero de Contacto"),i(),u(73,"input",33),m(74,St,3,2,"div",22),i(),o(75,"div",34)(76,"label",35),u(77,"i",36),a(78," Subir prueba de direcci\xF3n (PDF o imagen) "),i(),o(79,"input",37),x("change",function(d){return r.onFileSelected(d)}),i(),m(80,Mt,2,1,"div",38),i(),m(81,Ot,2,1,"div",39)(82,It,3,0,"div",40)(83,At,2,1,"div",41)(84,kt,2,1,"div",39),o(85,"button",42),a(86),i()()()),e&2){let l,d,C,$,Z,W;s(5),c("formGroup",r.registrationForm),s(8),c("disabled",r.isSubmitting),s(5),c("disabled",r.isSubmitting),s(4),c("disabled",r.isSubmitting),s(5),c("disabled",r.isSubmitting),s(4),c("disabled",r.isSubmitting),s(4),c("disabled",r.isSubmitting),s(5),c("disabled",r.isSubmitting||r.isLoadingGeografia),s(3),c("ngForOf",r.regiones),s(),c("ngIf",((l=r.registrationForm.get("idRegion"))==null?null:l.invalid)&&(((l=r.registrationForm.get("idRegion"))==null?null:l.touched)||((l=r.registrationForm.get("idRegion"))==null?null:l.dirty))),s(4),c("disabled",r.isSubmitting||r.isLoadingGeografia||!((d=r.registrationForm.get("idRegion"))!=null&&d.value)),s(3),c("ngForOf",r.provincias),s(),c("ngIf",((C=r.registrationForm.get("idProvincia"))==null?null:C.invalid)&&(((C=r.registrationForm.get("idProvincia"))==null?null:C.touched)||((C=r.registrationForm.get("idProvincia"))==null?null:C.dirty))),s(5),c("disabled",r.isSubmitting||r.isLoadingGeografia||!(($=r.registrationForm.get("idProvincia"))!=null&&$.value)),s(3),c("ngForOf",r.comunas),s(),c("ngIf",((Z=r.registrationForm.get("idComuna"))==null?null:Z.invalid)&&(((Z=r.registrationForm.get("idComuna"))==null?null:Z.touched)||((Z=r.registrationForm.get("idComuna"))==null?null:Z.dirty))),s(8),c("disabled",r.isSubmitting),s(4),c("disabled",r.isSubmitting),s(),c("ngIf",((W=r.registrationForm.get("numeroContacto"))==null?null:W.invalid)&&(((W=r.registrationForm.get("numeroContacto"))==null?null:W.touched)||((W=r.registrationForm.get("numeroContacto"))==null?null:W.dirty))),s(5),c("disabled",r.isSubmitting),s(),c("ngIf",r.selectedFile),s(),c("ngIf",r.fileError),s(),c("ngIf",r.isLoadingGeografia),s(),c("ngIf",r.successMessage),s(),c("ngIf",r.errorMessage),s(),c("disabled",r.isSubmitting||!r.registrationForm.valid),s(),b(" ",r.isSubmitting?"Guardando...":"Completar Registro"," ")}},dependencies:[F,L,y,Ye,se,de,pe,K,ce,Q,re,Ze,We],styles:["[_nghost-%COMP%]{display:flex;justify-content:center;align-items:center;height:100vh;background-color:#f4f7f6;font-family:Poppins,sans-serif}.form-container[_ngcontent-%COMP%]{background:#fff;padding:40px;border-radius:8px;box-shadow:0 4px 10px #0000001a;width:100%;max-width:600px}h2[_ngcontent-%COMP%]{text-align:center;color:#333;margin-bottom:10px}p[_ngcontent-%COMP%]{text-align:center;color:#666;margin-bottom:30px}.input-group[_ngcontent-%COMP%]{margin-bottom:20px}.input-group[_ngcontent-%COMP%]   label[_ngcontent-%COMP%]{display:block;margin-bottom:8px;font-weight:500;color:#444}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%], .input-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{width:100%;padding:10px;border:1px solid #ccc;border-radius:4px;box-sizing:border-box;font-size:14px}.input-group[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:read-only{background-color:#e9ecef;cursor:not-allowed}.input-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{background-color:#fff;cursor:pointer}.input-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:disabled{background-color:#e9ecef;cursor:not-allowed;color:#6c757d}.input-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]   option[_ngcontent-%COMP%]{padding:8px}input[type=file][_ngcontent-%COMP%]{margin-bottom:16px}.row[_ngcontent-%COMP%]{display:flex;gap:20px}.row[_ngcontent-%COMP%]   .input-group[_ngcontent-%COMP%]{flex:1}button[_ngcontent-%COMP%]{width:100%;padding:12px;background-color:#1e2a3a;color:#fff;border:none;border-radius:4px;cursor:pointer;font-size:16px;font-weight:600;transition:background-color .3s}button[_ngcontent-%COMP%]:disabled{background-color:#ccc;cursor:not-allowed}button[_ngcontent-%COMP%]:hover:not(:disabled){background-color:#34495e}.message[_ngcontent-%COMP%]{padding:10px;margin-bottom:20px;border-radius:4px;text-align:center}.success[_ngcontent-%COMP%]{background-color:#d4edda;color:#155724}.error[_ngcontent-%COMP%]{background-color:#f8d7da;color:#721c24}.input-group[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{outline:none;border-color:#1e2a3a;box-shadow:0 0 0 2px #1e2a3a33}.alert-info[_ngcontent-%COMP%]{background-color:#d1ecf1;color:#0c5460;border:1px solid #bee5eb;padding:10px;border-radius:4px;margin-bottom:15px}.alert-info[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{margin-right:8px}@media (max-width: 768px){.row[_ngcontent-%COMP%]{flex-direction:column;gap:0}.form-container[_ngcontent-%COMP%]{padding:20px;margin:20px}}"]})};function Dt(n,t){n&1&&(o(0,"div",7),a(1,"Cargando Listado de usuarios..."),i())}function Tt(n,t){if(n&1&&(o(0,"div",8),a(1),i()),n&2){let e=p();s(),f(e.error)}}function Bt(n,t){if(n&1&&(o(0,"div",16),u(1,"img",17),i()),n&2){let e=p().$implicit;s(),c("src",e.urlContrato,S)}}function Rt(n,t){if(n&1){let e=M();o(0,"tr")(1,"td"),a(2),i(),o(3,"td"),a(4),i(),o(5,"td")(6,"span"),a(7),i(),u(8,"br"),o(9,"span"),a(10),i()(),o(11,"td"),a(12),i(),o(13,"td"),a(14),i(),o(15,"td",10)(16,"a",11),x("mouseenter",function(){let l=_(e).$implicit,d=p(2);return v(d.mostrarPreview=l.id)})("mouseleave",function(){_(e);let l=p(2);return v(l.mostrarPreview=null)}),a(17),i(),m(18,Bt,2,1,"div",12),i(),o(19,"td"),a(20),i(),o(21,"td"),a(22),i(),o(23,"td"),a(24),i(),o(25,"td"),a(26),i(),o(27,"td")(28,"div",13)(29,"button",14),x("click",function(){let l=_(e).$implicit,d=p(2);return v(d.editarUsuario(l.id))}),a(30,"Editar"),i(),o(31,"button",15),x("click",function(){let l=_(e).$implicit,d=p(2);return v(d.eliminarUsuario(l.id))}),a(32,"Eliminar"),i()()()()}if(n&2){let e=t.$implicit,r=p(2);s(2),f(e.id),s(2),f(e.rut),s(3),f((e.primerNombre||"")+" "+(e.segundoNombre||"")),s(3),f((e.apellidoPaterno||"")+" "+(e.apellidoMaterno||"")),s(2),f(e.usuario),s(2),f(e.correo),s(2),Be("href",e.urlContrato,S),s(),b(" ",e.urlContrato," "),s(),c("ngIf",r.mostrarPreview===e.id),s(2),f(e.direccion),s(2),f(e.proveedorAutenticacion),s(2),f(e.rol.nombre),s(2),f(e.estado.estado)}}function Nt(n,t){if(n&1&&(o(0,"table")(1,"thead")(2,"tr")(3,"th"),a(4,"ID"),i(),o(5,"th"),a(6,"RUT"),i(),o(7,"th"),a(8,"Nombre Completo"),i(),o(9,"th"),a(10,"Usuario"),i(),o(11,"th"),a(12,"Correo"),i(),o(13,"th"),a(14,"URL Contrato"),i(),o(15,"th"),a(16,"Direcci\xF3n"),i(),o(17,"th"),a(18,"Proveedor Autenticaci\xF3n"),i(),o(19,"th"),a(20,"Rol"),i(),o(21,"th"),a(22,"Estado"),i(),o(23,"th"),a(24,"Acciones"),i()()(),o(25,"tbody"),m(26,Rt,33,13,"tr",9),i()()),n&2){let e=p();s(26),c("ngForOf",e.users)}}function zt(n,t){n&1&&(o(0,"div",18),a(1,"No hay usuarios registrados."),i())}var ve=class n{constructor(t,e){this.userService=t;this.router=e}users=[];loading=!0;error=null;mostrarPreview=null;ngOnInit(){return h(this,null,function*(){try{this.users=yield this.userService.listarUsuarios()}catch(t){this.error=t.message||"Error al cargar usuarios"}finally{this.loading=!1}})}eliminarUsuario(t){return h(this,null,function*(){if(confirm("\xBFEst\xE1s seguro de que deseas eliminar este usuario?"))try{yield this.userService.eliminarUsuario(t),this.users=this.users.filter(e=>e.id!==t)}catch(e){alert(e.message||"Error al eliminar usuario")}})}editarUsuario(t){this.router.navigate(["/dashboard/edit-user",t])}static \u0275fac=function(e){return new(e||n)(g(O),g(w))};static \u0275cmp=U({type:n,selectors:[["app-users-list"]],decls:8,vars:4,consts:[[1,"users-list-card"],[1,"users-list-title"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],[1,"table-responsive"],[4,"ngIf"],["class","no-users",4,"ngIf"],[1,"loading"],[1,"error"],[4,"ngFor","ngForOf"],[1,"url-contrato-cell",2,"position","relative"],["target","_blank",3,"mouseenter","mouseleave","href"],["class","img-preview-tooltip",4,"ngIf"],[1,"action-btn-group"],[1,"edit-btn",3,"click"],[1,"delete-btn",3,"click"],[1,"img-preview-tooltip"],["alt","Contrato",3,"src"],[1,"no-users"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"h2",1),a(2,"Lista de Usuarios"),i(),m(3,Dt,2,0,"div",2)(4,Tt,2,1,"div",3),o(5,"div",4),m(6,Nt,27,1,"table",5),i(),m(7,zt,2,0,"div",6),i()),e&2&&(s(3),c("ngIf",r.loading),s(),c("ngIf",r.error),s(2),c("ngIf",!r.loading&&!r.error&&r.users.length>0),s(),c("ngIf",!r.loading&&!r.error&&r.users.length===0))},dependencies:[F,L,y],styles:[".users-list-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #00000012;padding:2rem;margin:2rem 0;overflow-x:auto}.users-list-card[_ngcontent-%COMP%]{background:#fff;border-radius:18px;box-shadow:0 4px 24px #1976d21a;padding:2.5rem 2rem;margin:2.5rem auto;max-width:98vw;width:100%}.users-list-title[_ngcontent-%COMP%]{font-size:2rem;font-weight:700;color:#1a237e;margin-bottom:2rem;text-align:left}.table-responsive[_ngcontent-%COMP%]{overflow-x:auto}table[_ngcontent-%COMP%]{width:100%;border-collapse:separate;border-spacing:0;font-size:.92rem;background:#fff;border-radius:12px;overflow:hidden;min-width:1100px}th[_ngcontent-%COMP%], td[_ngcontent-%COMP%]{padding:1rem 1.2rem;text-align:left;font-size:.92rem}th[_ngcontent-%COMP%]{background:#f3f6fa;color:#16213e;font-weight:700;border-bottom:2.5px solid #e0e0e0;font-size:1.08rem;letter-spacing:.5px}tr[_ngcontent-%COMP%]{border-bottom:1px solid #f0f0f0;transition:background .2s}tr[_ngcontent-%COMP%]:nth-child(2n){background:#f9fbfd}tr[_ngcontent-%COMP%]:hover{background:#e3e8f0}tr[_ngcontent-%COMP%]:last-child{border-bottom:none}button[_ngcontent-%COMP%]{background-color:#e53935;color:#fff;border:none;padding:.4rem 1rem;border-radius:4px;cursor:pointer;font-weight:700;transition:background .2s;font-size:.95rem}button[_ngcontent-%COMP%]:hover{background-color:#b71c1c}.edit-btn[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;border:none;padding:.5rem 1.2rem;border-radius:8px;cursor:pointer;font-weight:700;margin-right:.5rem;transition:background .2s,box-shadow .2s;font-size:1rem;box-shadow:0 2px 8px #1976d214}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#0d47a1}.delete-btn[_ngcontent-%COMP%]{background-color:#e53935;color:#fff;border:none;padding:.5rem 1.2rem;border-radius:8px;cursor:pointer;font-weight:700;transition:background .2s,box-shadow .2s;font-size:1rem;box-shadow:0 2px 8px #e5393514}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#b71c1c}.no-users[_ngcontent-%COMP%]{text-align:center;color:#888;font-size:1.1rem;margin-top:2rem}.loading[_ngcontent-%COMP%]{text-align:center;color:#1976d2;font-size:1.1rem;margin-bottom:1rem}.error[_ngcontent-%COMP%]{color:#d32f2f;background:#ffebee;padding:1rem;border-radius:4px;margin-bottom:1rem;border-left:4px solid #d32f2f}.img-preview-tooltip[_ngcontent-%COMP%]{position:absolute;top:1.5em;left:0;z-index:10;background:#fff;border:1px solid #ddd;padding:6px;border-radius:8px;box-shadow:0 2px 8px #00000026;max-width:220px;max-height:220px}.img-preview-tooltip[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{max-width:200px;max-height:200px;display:block}@media (max-width: 900px){.users-list-card[_ngcontent-%COMP%]{padding:1.2rem .5rem}table[_ngcontent-%COMP%]{min-width:800px}}.action-btn-group[_ngcontent-%COMP%]{display:flex;flex-direction:row;justify-content:center;align-items:center;gap:.5rem}"]})};function Lt(n,t){if(n&1&&(o(0,"div",4)(1,"label"),a(2,"Previsualizaci\xF3n:"),i(),u(3,"img",17),i()),n&2){let e=p();s(3),c("src",e.fotoPreview,S)}}var he=class n{constructor(t,e,r,l,d){this.http=t;this.router=e;this.route=r;this.authService=l;this.userService=d}title="Publicar Producto";username="Invitado";userRole="";isAdmin=!1;subscriptions=new te;publicacion={titulo:"",descripcion:"",precio:null,idAutor:null};estados=[];foto=null;fotoPreview=null;ngOnInit(){let t=this.authService.getToken();console.log("[PublicarProducto] Token en ngOnInit:",t),this.http.get(`${P.publicacionesApiUrl}/estados`).subscribe(l=>this.estados=l),this.subscriptions.add(this.userService.userName$.subscribe(l=>{if(this.username=l,!l||l==="Invitado"||l==="unknown"){let d=this.userService.getUserNameFromMSAL();this.userService.setUserName(d),this.username=d}}));let e=this.authService.getUserInfo();console.log("[PublicarProducto] userInfo extra\xEDdo:",e);let r=e?.email||Array.isArray(e?.emails)&&e.emails[0]||void 0;console.log("[PublicarProducto] Email extra\xEDdo:",r),r&&(this.userService.getUsuarioIdPorCorreo(r).then(l=>{console.log("[PublicarProducto] id obtenido para publicaci\xF3n:",l),this.publicacion.idAutor=l}).catch(l=>{console.error("[PublicarProducto] Error al obtener id por correo:",l)}),this.userService.getUsuarioPorCorreo(r).then(l=>{l&&l.rol&&(this.userRole=l.rol.nombre,this.isAdmin=this.userRole.toLowerCase()==="administrador",console.log("[PublicarProducto] Rol detectado:",this.userRole,"isAdmin:",this.isAdmin))}).catch(l=>{console.error("[PublicarProducto] Error al obtener informaci\xF3n del usuario:",l)}))}ngOnDestroy(){this.subscriptions.unsubscribe()}onFileSelected(t){let e=t.target;if(e.files&&e.files.length>0){this.foto=e.files[0];let r=new FileReader;r.onload=l=>{this.fotoPreview=r.result},r.readAsDataURL(this.foto)}else this.foto=null,this.fotoPreview=null}onSubmit(t){console.log("[PublicarProducto] idAutor antes de enviar:",this.publicacion.idAutor);let e=this.authService.getToken();if(!e){alert("Debes iniciar sesi\xF3n");return}let r=new FormData;r.append("titulo",this.publicacion.titulo),r.append("descripcion",this.publicacion.descripcion),r.append("precio",this.publicacion.precio?.toString()||""),r.append("idAutor",this.publicacion.idAutor?.toString()||""),r.append("estadoId",t.toString()),this.foto&&r.append("file",this.foto);let l=new B({Authorization:`Bearer ${e}`});this.http.post(`${P.publicacionesApiUrl}/publicaciones`,r,{headers:l}).subscribe({next:d=>{alert(t===1?"\xA1Producto publicado!":"\xA1Guardado como borrador!"),this.router.navigate(["../mis-productos"],{relativeTo:this.route})},error:d=>{alert("Error al publicar: "+(d.error?.message||d.statusText))}})}logout(){this.authService.logout(),this.router.navigate(["/login"])}static \u0275fac=function(e){return new(e||n)(g(V),g(w),g(j),g(I),g(O))};static \u0275cmp=U({type:n,selectors:[["app-publicar-producto"]],decls:27,vars:5,consts:[[1,"publish-form-area"],[1,"form-container"],[1,"form-title"],[1,"product-form"],[1,"form-group"],["for","titulo"],["id","titulo","name","titulo","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","descripcion"],["id","descripcion","name","descripcion","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","precio"],["id","precio","name","precio","type","number","required","",1,"form-control",3,"ngModelChange","ngModel"],["for","foto"],["id","foto","name","foto","type","file","accept","image/*",1,"form-control",3,"change"],["class","form-group",4,"ngIf"],[1,"form-group",2,"display","flex","gap","1rem","justify-content","center"],["type","button",1,"submit-btn",3,"click"],["type","button",1,"submit-btn","draft",3,"click"],["alt","Previsualizaci\xF3n de la foto",2,"max-width","200px","max-height","200px","display","block","margin","0 auto","border","1px solid #ccc","border-radius","8px",3,"src"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"div",1)(2,"h2",2),a(3),i(),o(4,"form",3)(5,"div",4)(6,"label",5),a(7,"T\xEDtulo:"),i(),o(8,"input",6),D("ngModelChange",function(d){return k(r.publicacion.titulo,d)||(r.publicacion.titulo=d),d}),i()(),o(9,"div",4)(10,"label",7),a(11,"Descripci\xF3n:"),i(),o(12,"textarea",8),D("ngModelChange",function(d){return k(r.publicacion.descripcion,d)||(r.publicacion.descripcion=d),d}),i()(),o(13,"div",4)(14,"label",9),a(15,"Precio:"),i(),o(16,"input",10),D("ngModelChange",function(d){return k(r.publicacion.precio,d)||(r.publicacion.precio=d),d}),i()(),o(17,"div",4)(18,"label",11),a(19,"Foto:"),i(),o(20,"input",12),x("change",function(d){return r.onFileSelected(d)}),i()(),m(21,Lt,4,1,"div",13),o(22,"div",14)(23,"button",15),x("click",function(){return r.onSubmit(1)}),a(24,"Publicar"),i(),o(25,"button",16),x("click",function(){return r.onSubmit(2)}),a(26,"Guardar como borrador"),i()()()()()),e&2&&(s(3),f(r.title),s(5),A("ngModel",r.publicacion.titulo),s(4),A("ngModel",r.publicacion.descripcion),s(4),A("ngModel",r.publicacion.precio),s(5),c("ngIf",r.fotoPreview))},dependencies:[F,y,Y,se,K,le,Q,re,Ke,ae,qe,H],styles:['@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJbecmNE.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJnecmNE.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:400;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiEyp8kv8JHgFVrJJfecg.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:500;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLGT9Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:600;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLEj6Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z11lFc-K.woff2) format("woff2");unicode-range:U+0900-097F,U+1CD0-1CF9,U+200C-200D,U+20A8,U+20B9,U+20F0,U+25CC,U+A830-A839,U+A8E0-A8FF,U+11B00-11B09}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1JlFc-K.woff2) format("woff2");unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:Poppins;font-style:normal;font-weight:700;font-display:swap;src:url(https://fonts.gstatic.com/s/poppins/v23/pxiByp8kv8JHgFVrLCz7Z1xlFQ.woff2) format("woff2");unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}[_nghost-%COMP%]{font-family:Poppins,sans-serif}.dashboard-layout[_ngcontent-%COMP%]{display:flex;min-height:100vh;background:#f8f9fb}.sidebar[_ngcontent-%COMP%]{width:220px;background:#22314a;color:#fff;display:flex;flex-direction:column;justify-content:space-between;padding:24px 0 0}.logo-area[_ngcontent-%COMP%]{display:flex;align-items:center;font-size:1.5rem;font-weight:700;padding:0 24px 32px;gap:10px}.logo-icon[_ngcontent-%COMP%]{font-size:1.6rem}.logo-text[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;letter-spacing:.5px}.user-list[_ngcontent-%COMP%]{list-style:none;padding:0 24px;margin:0 0 32px}.user-list[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{display:flex;align-items:center;gap:10px;font-size:1rem;margin-bottom:18px}.user-icon[_ngcontent-%COMP%]{font-size:1.1rem}.sidebar-footer[_ngcontent-%COMP%]{margin-top:auto;padding:0 24px 24px}.social-icons[_ngcontent-%COMP%]{display:flex;gap:16px;margin-bottom:10px}.social-icons[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1.2rem;color:#fff;opacity:.8}.phone[_ngcontent-%COMP%]{font-size:.95rem;color:#fff;opacity:.9;margin-bottom:16px}.logout-btn[_ngcontent-%COMP%]{background:#dc3545!important;color:#fff!important;border:none!important;border-radius:6px;padding:8px 16px;font-size:.9rem;font-weight:500;cursor:pointer;transition:background .2s;width:100%;display:flex;align-items:center;justify-content:center;gap:8px;opacity:1!important;box-shadow:none!important;margin-top:1.2rem}.logout-btn[_ngcontent-%COMP%]:hover{background:#c82333!important;color:#fff!important;opacity:1!important}.logout-btn[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:1rem}.main-content[_ngcontent-%COMP%]{flex:1;display:flex;flex-direction:column;background:#f8f9fb}.main-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;background:#22314a;color:#fff;padding:18px 32px;font-size:1.1rem;font-weight:500}.welcome-message[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{margin:0 0 4px;font-size:1.4rem;font-weight:600}.user-info[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px}.user-avatar[_ngcontent-%COMP%]{background:#fff;color:#22314a;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;font-size:1.2rem}.sidebar-links[_ngcontent-%COMP%]{border-radius:8px;margin:0 24px 32px;padding:0;background:transparent}.sidebar-links[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style:none;padding:0;margin:0}.sidebar-links[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-bottom:16px}.sidebar-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{color:#fff;text-decoration:none;font-weight:500;font-size:1rem;transition:color .2s}.sidebar-links[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#3ee14b}.publish-form-area[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:80vh}.form-container[_ngcontent-%COMP%]{background:#fff;border-radius:12px;box-shadow:0 2px 12px #00000014;padding:2rem 2.5rem;min-width:350px;max-width:400px;width:100%;display:flex;flex-direction:column;align-items:center}.form-title[_ngcontent-%COMP%]{font-size:1.6rem;font-weight:600;margin-bottom:1.5rem;color:#22314f}.product-form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:1rem}.form-group[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;gap:.3rem}.form-control[_ngcontent-%COMP%]{padding:.5rem .8rem;border:1px solid #d1d5db;border-radius:6px;font-size:1rem;background:#f9fafb;transition:border .2s}.form-control[_ngcontent-%COMP%]:focus{border:1.5px solid #4f46e5;outline:none;background:#fff}.submit-btn[_ngcontent-%COMP%]{background:#22314f;color:#fff;border:none;border-radius:6px;padding:.7rem 1.2rem;font-size:1rem;font-weight:500;cursor:pointer;margin-top:1rem;transition:background .2s}.submit-btn[_ngcontent-%COMP%]:hover{background:#4f46e5}.submit-btn.draft[_ngcontent-%COMP%]{background:#e0e0e0!important;color:#22314f!important;border:none;border-radius:6px;font-weight:500;transition:background .2s}.submit-btn.draft[_ngcontent-%COMP%]:hover{background:#bdbdbd!important;color:#22314f!important}.logout-btn[_ngcontent-%COMP%]{background:transparent;color:#22314f;border:1px solid #22314f;border-radius:6px;padding:.5rem 1.2rem;font-size:1rem;font-weight:500;cursor:pointer;margin-top:1.2rem;transition:background .2s,color .2s}.logout-btn[_ngcontent-%COMP%]:hover{background:#22314f;color:#fff}.hidden-title[_ngcontent-%COMP%], .form-control-file[_ngcontent-%COMP%]{display:none}.image-upload-box[_ngcontent-%COMP%]{border:1.5px dashed #bfc9d9;border-radius:8px;background:#fafbfc;padding:24px 0;text-align:center;cursor:pointer;position:relative;transition:border .2s}.image-upload-box[_ngcontent-%COMP%]:hover{border-color:#22314a}.image-upload-label[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;color:#bfc9d9;font-size:1rem;pointer-events:none}.image-upload-label[_ngcontent-%COMP%]   i[_ngcontent-%COMP%]{font-size:2.2rem;margin-bottom:6px}@media (max-width: 700px){.product-form[_ngcontent-%COMP%]{max-width:95vw;min-width:unset;padding:24px 8px}}']})};var Vt=n=>["/dashboard/producto",n];function jt(n,t){n&1&&(o(0,"div",5),a(1,"Cargando productos..."),i())}function Ht(n,t){if(n&1&&(o(0,"div",6),a(1),i()),n&2){let e=p();s(),f(e.error)}}function Jt(n,t){n&1&&(o(0,"span",20),a(1," \u2714\uFE0F "),i())}function $t(n,t){n&1&&(o(0,"span",21),a(1," \u{1F7E6} "),i())}function Gt(n,t){n&1&&(o(0,"span",22),a(1," \u{1F7E8} "),i())}function qt(n,t){if(n&1&&(o(0,"div",23),a(1),i()),n&2){let e=p().$implicit;s(),b("Estado: ",(e.estado==null?null:e.estado.nombre)||e.estado,"")}}function Zt(n,t){if(n&1&&(o(0,"option",34),a(1),i()),n&2){let e=t.$implicit;c("ngValue",e),s(),f(e.nombre)}}function Wt(n,t){if(n&1){let e=M();o(0,"div",24)(1,"input",25),D("ngModelChange",function(l){_(e);let d=p(2);return k(d.editedProduct.titulo,l)||(d.editedProduct.titulo=l),v(l)}),i(),o(2,"textarea",26),D("ngModelChange",function(l){_(e);let d=p(2);return k(d.editedProduct.descripcion,l)||(d.editedProduct.descripcion=l),v(l)}),i(),o(3,"input",27),D("ngModelChange",function(l){_(e);let d=p(2);return k(d.editedProduct.precio,l)||(d.editedProduct.precio=l),v(l)}),i(),o(4,"select",28),D("ngModelChange",function(l){_(e);let d=p(2);return k(d.editedProduct.estado,l)||(d.editedProduct.estado=l),v(l)}),m(5,Zt,2,2,"option",29),i(),o(6,"div",30)(7,"button",31),x("click",function(){_(e);let l=p().$implicit,d=p();return v(d.guardarEdicionPublicacion(l))}),o(8,"span",32),a(9,"\u{1F4BE}"),i(),a(10,"Guardar"),i(),o(11,"button",33),x("click",function(){_(e);let l=p(2);return v(l.cancelarEdicionPublicacion())}),o(12,"span",32),a(13,"\u2716\uFE0F"),i(),a(14,"Cancelar"),i()()()}if(n&2){let e=p(2);s(),A("ngModel",e.editedProduct.titulo),s(),A("ngModel",e.editedProduct.descripcion),s(),A("ngModel",e.editedProduct.precio),s(),A("ngModel",e.editedProduct.estado),s(),c("ngForOf",e.estados)}}function Kt(n,t){if(n&1){let e=M();o(0,"div",30)(1,"button",31),x("click",function(){_(e);let l=p().$implicit,d=p();return v(d.editarPublicacion(l))}),o(2,"span",32),a(3,"\u270F\uFE0F"),i(),a(4,"Editar"),i(),o(5,"button",33),x("click",function(){_(e);let l=p().$implicit,d=p();return v(d.borrarPublicacion(l.id))}),o(6,"span",32),a(7,"\u{1F5D1}\uFE0F"),i(),a(8,"Borrar"),i()()}}function Qt(n,t){if(n&1&&(o(0,"div",7)(1,"div",8),u(2,"img",9),m(3,Jt,2,0,"span",10)(4,$t,2,0,"span",11)(5,Gt,2,0,"span",12),i(),o(6,"div",13),a(7),i(),o(8,"div",14),a(9),i(),o(10,"div",15),a(11),T(12,"currency"),i(),m(13,qt,2,1,"div",16),o(14,"a",17),a(15,"Ver m\xE1s"),i(),m(16,Wt,15,5,"div",18)(17,Kt,9,0,"div",19),i()),n&2){let e=t.$implicit,r=p();s(2),c("src",e.urlFoto||"assets/no-image.png",S)("alt",e.titulo),s(),c("ngIf",r.isAdmin()&&e.estado&&e.estado.nombre==="Aprobado"),s(),c("ngIf",r.isAdmin()&&e.estado&&e.estado.nombre==="Publicado"),s(),c("ngIf",r.isAdmin()&&e.estado&&e.estado.nombre==="Borrador"),s(2),f(e.titulo),s(2),f(e.descripcion),s(2),b("Precio: ",G(12,12,e.precio,"USD","symbol","1.0-0"),""),s(2),c("ngIf",r.isAdmin()),s(),c("routerLink",Ne(17,Vt,e.id)),s(2),c("ngIf",r.isAdmin()&&r.editingProductId===e.id),s(),c("ngIf",r.isAdmin()&&r.editingProductId!==e.id)}}var Ce=class n{constructor(t,e){this.http=t;this.userService=e}products=[];loading=!0;error=null;editingProductId=null;editedProduct={titulo:"",descripcion:"",precio:0,estado:null};estados=[];ngOnInit(){this.fetchAllProducts(),this.fetchEstados()}fetchAllProducts(){this.loading=!0,this.error=null;let t=localStorage.getItem("token"),e=t?new B({Authorization:`Bearer ${t}`}):void 0;this.http.get(`${P.publicacionesApiUrl}/publicaciones`,{headers:e}).subscribe({next:r=>{let l=this.userService.getRol();console.log("Rol actual:",l),typeof l=="number"&&l===1||typeof l=="object"&&l&&l.id===1?this.products=r:this.products=r.filter(d=>d.estado&&typeof d.estado.nombre=="string"&&(d.estado.nombre.trim().toLowerCase()==="publicado"||d.estado.nombre.trim().toLowerCase()==="pendiente")),this.loading=!1},error:r=>{this.error="Error al cargar el listado global de productos.",this.loading=!1}})}fetchEstados(){let t=localStorage.getItem("token"),e=t?new B({Authorization:`Bearer ${t}`}):void 0;this.http.get(`${P.publicacionesApiUrl}/estados`,{headers:e}).subscribe({next:r=>{this.estados=r},error:r=>{this.estados=[]}})}isAdmin(){let t=this.userService.getRol();return!!(typeof t=="number"&&t===1||typeof t=="object"&&t&&t.id===1)}borrarPublicacion(t){if(this.isAdmin()&&confirm("\xBFSeguro que deseas borrar esta publicaci\xF3n?")){let e=localStorage.getItem("token"),r=e?new B({Authorization:`Bearer ${e}`}):void 0;this.http.delete(`${P.publicacionesApiUrl}/publicaciones/${t}`,{headers:r}).subscribe({next:()=>{this.products=this.products.filter(l=>l.id!==t),alert("Publicaci\xF3n eliminada correctamente")},error:()=>alert("Error al eliminar la publicaci\xF3n")})}}editarPublicacion(t){this.isAdmin()&&(this.editingProductId=t.id,this.editedProduct={titulo:t.titulo,descripcion:t.descripcion,precio:t.precio,estado:t.estado?.id||t.estado})}cancelarEdicionPublicacion(){this.editingProductId=null,this.editedProduct={titulo:"",descripcion:"",precio:0,estado:null}}guardarEdicionPublicacion(t){if(!this.isAdmin())return;let e=localStorage.getItem("token"),r=e?new B({Authorization:`Bearer ${e}`}):void 0,l={id:t.id,titulo:this.editedProduct.titulo,descripcion:this.editedProduct.descripcion,precio:this.editedProduct.precio,estado:{id:this.editedProduct.estado}};console.log("Enviando al backend:",l),this.http.put(`${P.publicacionesApiUrl}/publicaciones/${t.id}`,l,{headers:r}).subscribe({next:d=>{let C=this.products.findIndex($=>$.id===t.id);C!==-1&&(this.products[C]=d),this.cancelarEdicionPublicacion(),alert("Publicaci\xF3n editada correctamente")},error:d=>{alert("Error al editar la publicaci\xF3n"),console.error("Error PUT:",d)}})}static \u0275fac=function(e){return new(e||n)(g(V),g(O))};static \u0275cmp=U({type:n,selectors:[["app-all-products"]],decls:7,vars:3,consts:[[1,"all-products-container"],["class","loading",4,"ngIf"],["class","alert alert-danger","role","alert",4,"ngIf"],[1,"products-grid"],["class","product-card",4,"ngFor","ngForOf"],[1,"loading"],["role","alert",1,"alert","alert-danger"],[1,"product-card"],[2,"position","relative"],[3,"src","alt"],["style","position: absolute; top: 8px; left: 8px; background: #00e676; color: white; border-radius: 50%; padding: 6px; font-size: 1.2rem; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.15);",4,"ngIf"],["style","position: absolute; top: 8px; left: 8px; background: #2196f3; color: white; border-radius: 50%; padding: 6px; font-size: 1.2rem; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.15);",4,"ngIf"],["style","position: absolute; top: 8px; left: 8px; background: #ffd600; color: #333; border-radius: 50%; padding: 6px; font-size: 1.2rem; z-index: 2; box-shadow: 0 2px 8px rgba(0,0,0,0.15);",4,"ngIf"],[1,"product-title"],[1,"product-description"],[1,"product-price"],["class","product-estado",4,"ngIf"],[1,"see-more-btn",3,"routerLink"],["class","edit-inline-block",4,"ngIf"],["class","admin-product-actions",4,"ngIf"],[2,"position","absolute","top","8px","left","8px","background","#00e676","color","white","border-radius","50%","padding","6px","font-size","1.2rem","z-index","2","box-shadow","0 2px 8px rgba(0,0,0,0.15)"],[2,"position","absolute","top","8px","left","8px","background","#2196f3","color","white","border-radius","50%","padding","6px","font-size","1.2rem","z-index","2","box-shadow","0 2px 8px rgba(0,0,0,0.15)"],[2,"position","absolute","top","8px","left","8px","background","#ffd600","color","#333","border-radius","50%","padding","6px","font-size","1.2rem","z-index","2","box-shadow","0 2px 8px rgba(0,0,0,0.15)"],[1,"product-estado"],[1,"edit-inline-block"],["placeholder","T\xEDtulo",1,"edit-input",3,"ngModelChange","ngModel"],["placeholder","Descripci\xF3n",1,"edit-input",3,"ngModelChange","ngModel"],["type","number","placeholder","Precio",1,"edit-input",3,"ngModelChange","ngModel"],[1,"edit-input",3,"ngModelChange","ngModel"],[3,"ngValue",4,"ngFor","ngForOf"],[1,"admin-product-actions"],[1,"edit-btn",3,"click"],[1,"icon"],[1,"delete-btn",3,"click"],[3,"ngValue"]],template:function(e,r){e&1&&(o(0,"div",0)(1,"h2"),a(2,"Listado de Productos"),i(),m(3,jt,2,0,"div",1)(4,Ht,2,1,"div",2),o(5,"div",3),m(6,Qt,18,19,"div",4),i()()),e&2&&(s(3),c("ngIf",r.loading),s(),c("ngIf",r.error),s(2),c("ngForOf",r.products))},dependencies:[F,L,y,ie,H,oe,Y,de,pe,K,le,ce,Q,ae],styles:[".all-products-container[_ngcontent-%COMP%]{max-width:1200px;margin:40px auto;padding:2rem;background:#fff;border-radius:16px;box-shadow:0 2px 16px #22314a1a}h2[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem;color:#1a237e}.products-grid[_ngcontent-%COMP%]{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:32px}.product-card[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:12px;box-shadow:0 2px 8px #22314a12;display:flex;flex-direction:column;align-items:center;padding:18px 12px 20px;transition:box-shadow .2s}.product-card[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:140px;height:110px;object-fit:cover;border-radius:8px;margin-bottom:16px}.product-title[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;margin-bottom:.5rem;color:#22314a;text-align:center}.product-description[_ngcontent-%COMP%]{font-size:.95rem;color:#495057;margin-bottom:.5rem;text-align:center}.product-price[_ngcontent-%COMP%], .product-estado[_ngcontent-%COMP%]{font-size:.95rem;color:#22314a;margin-bottom:.3rem}.see-more-btn[_ngcontent-%COMP%]{background:#22314a;color:#fff;border:none;border-radius:6px;padding:.5rem 1.2rem;font-weight:500;font-size:1rem;cursor:pointer;margin-top:.7rem;text-decoration:none;display:inline-block;transition:background .2s}.see-more-btn[_ngcontent-%COMP%]:hover{background:#1a2333}.loading[_ngcontent-%COMP%], .error[_ngcontent-%COMP%]{text-align:center;margin:1.5rem 0;font-size:1.1rem}.error[_ngcontent-%COMP%]{color:#d32f2f;background:#ffebee;padding:1rem;border-radius:4px;margin-bottom:1rem;border-left:4px solid #d32f2f}.admin-product-actions[_ngcontent-%COMP%]{display:flex;gap:10px;margin-top:8px}.edit-btn[_ngcontent-%COMP%]{background-color:#1976d2;color:#fff;border:none;border-radius:4px;padding:6px 14px;cursor:pointer;font-size:14px;display:flex;align-items:center;transition:background .2s}.edit-btn[_ngcontent-%COMP%]:hover{background-color:#125ea2}.delete-btn[_ngcontent-%COMP%]{background-color:#e53935;color:#fff;border:none;border-radius:4px;padding:6px 14px;cursor:pointer;font-size:14px;display:flex;align-items:center;transition:background .2s}.delete-btn[_ngcontent-%COMP%]:hover{background-color:#b71c1c}.edit-btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%], .delete-btn[_ngcontent-%COMP%]   .icon[_ngcontent-%COMP%]{margin-right:6px}.edit-inline-block[_ngcontent-%COMP%]{background:#f5f7fa;border:1.5px solid #1976d2;border-radius:8px;padding:16px 12px;margin-top:10px;display:flex;flex-direction:column;align-items:stretch;box-shadow:0 2px 8px #1976d214}.edit-inline-block[_ngcontent-%COMP%]   .edit-input[_ngcontent-%COMP%]{margin-bottom:10px;padding:7px 10px;border-radius:4px;border:1px solid #bdbdbd;font-size:15px;width:100%;box-sizing:border-box}.edit-inline-block[_ngcontent-%COMP%]   .admin-product-actions[_ngcontent-%COMP%]{flex-direction:row;justify-content:center;gap:12px;margin-top:8px}"]})};function Yt(n,t){n&1&&(o(0,"div",7),a(1," Cargando intercambios... "),i())}function Xt(n,t){if(n&1&&(o(0,"div",8),a(1),i()),n&2){let e=p();s(),b(" ",e.error," ")}}function ei(n,t){n&1&&(o(0,"div",16)(1,"p"),a(2,"No tienes ofertas de intercambio recibidas."),i()())}function ti(n,t){if(n&1&&(Ee(0),a(1),Se()),n&2){let e=p().$implicit,r=p(3);s(),b(" ",r.getUserNameById(e.idUsuarioSolicitante)," ")}}function ii(n,t){n&1&&u(0,"span",32)}function ni(n,t){if(n&1){let e=M();o(0,"div",33)(1,"button",34),x("click",function(){_(e);let l=p().$implicit,d=p(3);return v(d.aceptarOferta(l.id))}),a(2," \u2705 Aceptar "),i(),o(3,"button",35),x("click",function(){_(e);let l=p().$implicit,d=p(3);return v(d.rechazarOferta(l.id))}),a(4," \u274C Rechazar "),i()()}}function oi(n,t){if(n&1){let e=M();o(0,"div")(1,"button",34),x("click",function(){_(e);let l=p(2).$implicit,d=p(3);return v(d.confirmarIntercambio(l.id))}),a(2,"\u2705 Confirmar recepci\xF3n"),i(),o(3,"button",35),x("click",function(){_(e);let l=p(2).$implicit,d=p(3);return v(d.revertirIntercambio(l.id))}),a(4,"\u21A9\uFE0F Revertir"),i()()}}function ri(n,t){n&1&&(o(0,"div")(1,"span",39),a(2,"\u23F3 Esperando confirmaci\xF3n del otro usuario..."),i()())}function ai(n,t){n&1&&(o(0,"div")(1,"span",40),a(2,"\u{1F389} Intercambio finalizado y aprobado"),i()())}function si(n,t){n&1&&(o(0,"div")(1,"span",41),a(2,"\u274C Intercambio cancelado/devuelto"),i()())}function li(n,t){if(n&1&&(o(0,"div",36)(1,"div",37)(2,"span"),a(3," Tu confirmaci\xF3n: "),o(4,"b"),a(5),i()(),o(6,"span"),a(7," Confirmaci\xF3n del otro usuario: "),o(8,"b"),a(9),i()()(),m(10,oi,5,0,"div",38)(11,ri,3,0,"div",38)(12,ai,3,0,"div",38)(13,si,3,0,"div",38),i()),n&2){let e=p().$implicit;s(5),f(e.confirmacionPropietario),s(4),f(e.confirmacionSolicitante),s(),c("ngIf",e.confirmacionPropietario==="PENDIENTE"),s(),c("ngIf",e.confirmacionPropietario==="CONFIRMADO"&&e.confirmacionSolicitante!=="CONFIRMADO"),s(),c("ngIf",e.confirmacionPropietario==="CONFIRMADO"&&e.confirmacionSolicitante==="CONFIRMADO"),s(),c("ngIf",e.confirmacionPropietario==="REVERTIDO"||e.confirmacionSolicitante==="REVERTIDO")}}function ci(n,t){if(n&1&&(o(0,"small"),a(1),i()),n&2){let e=p(2).$implicit,r=p(3);s(),b(" Respondido: ",r.formatDate(e.fechaRespuesta)," ")}}function di(n,t){if(n&1&&(o(0,"div",36)(1,"span",42),a(2,"\u274C Intercambio rechazado"),i(),m(3,ci,2,1,"small",38),i()),n&2){let e=p().$implicit;s(3),c("ngIf",e.fechaRespuesta)}}function pi(n,t){if(n&1&&(o(0,"div",17)(1,"div",18)(2,"h3"),a(3," Oferta de "),m(4,ti,2,1,"ng-container",19)(5,ii,1,0,"ng-template",null,0,Oe),i(),o(7,"span"),a(8),i()(),o(9,"div",20)(10,"div",21)(11,"h4"),a(12,"Tu Producto (Solicitado)"),i(),o(13,"div",22),u(14,"img",23),o(15,"div",24)(16,"h5"),a(17),i(),o(18,"p"),a(19),i(),o(20,"p",25),a(21),T(22,"currency"),i()()()(),o(23,"div",26),a(24,"\u21C4"),i(),o(25,"div",27)(26,"h4"),a(27,"Producto Ofrecido"),i(),o(28,"div",22),u(29,"img",23),o(30,"div",24)(31,"h5"),a(32),i(),o(33,"p"),a(34),i(),o(35,"p",25),a(36),T(37,"currency"),i()()()()(),o(38,"div",28)(39,"div",29)(40,"small"),a(41),i()(),m(42,ni,5,0,"div",30)(43,li,14,6,"div",31)(44,di,4,1,"div",31),i()()),n&2){let e=t.$implicit,r=Me(6),l=p(3);s(4),c("ngIf",l.getUserNameById(e.idUsuarioSolicitante))("ngIfElse",r),s(3),we(l.getEstadoClass(e.estadoIntercambio)),s(),b(" ",l.getEstadoText(e.estadoIntercambio)," "),s(6),c("src",e.productoSolicitado.urlFoto||"assets/no-image.png",S)("alt",e.productoSolicitado.titulo),s(3),f(e.productoSolicitado.titulo),s(2),f(e.productoSolicitado.descripcion),s(2),f(G(22,19,e.productoSolicitado.precio,"USD","symbol","1.0-0")),s(8),c("src",e.productoOfrecido.urlFoto||"assets/no-image.png",S)("alt",e.productoOfrecido.titulo),s(3),f(e.productoOfrecido.titulo),s(2),f(e.productoOfrecido.descripcion),s(2),f(G(37,24,e.productoOfrecido.precio,"USD","symbol","1.0-0")),s(5),b("Oferta enviada: ",l.formatDate(e.fechaCreacion),""),s(),c("ngIf",e.estadoIntercambio==="PENDIENTE"),s(),c("ngIf",e.estadoIntercambio==="ACEPTADO"),s(),c("ngIf",e.estadoIntercambio==="RECHAZADO")}}function mi(n,t){if(n&1&&(o(0,"div",13),m(1,ei,3,0,"div",14)(2,pi,45,29,"div",15),i()),n&2){let e=p(2);s(),c("ngIf",e.ofertasRecibidas.length===0),s(),c("ngForOf",e.ofertasRecibidas)}}function ui(n,t){n&1&&(o(0,"div",16)(1,"p"),a(2,"No has enviado ofertas de intercambio."),i()())}function fi(n,t){if(n&1&&(Ee(0),a(1),Se()),n&2){let e=p().$implicit,r=p(3);s(),b(" ",r.getUserNameById(e.idUsuarioPropietario)," ")}}function gi(n,t){n&1&&u(0,"span",32)}function bi(n,t){if(n&1&&(o(0,"small"),a(1),i()),n&2){let e=p(2).$implicit,r=p(3);s(),b(" Respondido: ",r.formatDate(e.fechaRespuesta)," ")}}function xi(n,t){if(n&1&&(o(0,"div",36)(1,"span",43),a(2,"\u2705 Tu oferta fue aceptada"),i(),m(3,bi,2,1,"small",38),i()),n&2){let e=p().$implicit;s(3),c("ngIf",e.fechaRespuesta)}}function _i(n,t){if(n&1&&(o(0,"small"),a(1),i()),n&2){let e=p(2).$implicit,r=p(3);s(),b(" Respondido: ",r.formatDate(e.fechaRespuesta)," ")}}function vi(n,t){if(n&1&&(o(0,"div",36)(1,"span",42),a(2,"\u274C Tu oferta fue rechazada"),i(),m(3,_i,2,1,"small",38),i()),n&2){let e=p().$implicit;s(3),c("ngIf",e.fechaRespuesta)}}function hi(n,t){n&1&&(o(0,"div",36)(1,"span",44),a(2,"\u23F3 Esperando respuesta"),i()())}function Ci(n,t){if(n&1&&(o(0,"div",17)(1,"div",18)(2,"h3"),a(3," Oferta para "),m(4,fi,2,1,"ng-container",19)(5,gi,1,0,"ng-template",null,1,Oe),i(),o(7,"span"),a(8),i()(),o(9,"div",20)(10,"div",21)(11,"h4"),a(12,"Producto Solicitado"),i(),o(13,"div",22),u(14,"img",23),o(15,"div",24)(16,"h5"),a(17),i(),o(18,"p"),a(19),i(),o(20,"p",25),a(21),T(22,"currency"),i()()()(),o(23,"div",26),a(24,"\u21C4"),i(),o(25,"div",27)(26,"h4"),a(27,"Tu Producto (Ofrecido)"),i(),o(28,"div",22),u(29,"img",23),o(30,"div",24)(31,"h5"),a(32),i(),o(33,"p"),a(34),i(),o(35,"p",25),a(36),T(37,"currency"),i()()()()(),o(38,"div",28)(39,"div",29)(40,"small"),a(41),i()(),m(42,xi,4,1,"div",31)(43,vi,4,1,"div",31)(44,hi,3,0,"div",31),i()()),n&2){let e=t.$implicit,r=Me(6),l=p(3);s(4),c("ngIf",l.getUserNameById(e.idUsuarioPropietario))("ngIfElse",r),s(3),we(l.getEstadoClass(e.estadoIntercambio)),s(),b(" ",l.getEstadoText(e.estadoIntercambio)," "),s(6),c("src",e.productoSolicitado.urlFoto||"assets/no-image.png",S)("alt",e.productoSolicitado.titulo),s(3),f(e.productoSolicitado.titulo),s(2),f(e.productoSolicitado.descripcion),s(2),f(G(22,19,e.productoSolicitado.precio,"USD","symbol","1.0-0")),s(8),c("src",e.productoOfrecido.urlFoto||"assets/no-image.png",S)("alt",e.productoOfrecido.titulo),s(3),f(e.productoOfrecido.titulo),s(2),f(e.productoOfrecido.descripcion),s(2),f(G(37,24,e.productoOfrecido.precio,"USD","symbol","1.0-0")),s(5),b("Oferta enviada: ",l.formatDate(e.fechaCreacion),""),s(),c("ngIf",e.estadoIntercambio==="ACEPTADO"),s(),c("ngIf",e.estadoIntercambio==="RECHAZADO"),s(),c("ngIf",e.estadoIntercambio==="PENDIENTE")}}function Ui(n,t){if(n&1&&(o(0,"div",13),m(1,ui,3,0,"div",14)(2,Ci,45,29,"div",15),i()),n&2){let e=p(2);s(),c("ngIf",e.ofertasEnviadas.length===0),s(),c("ngForOf",e.ofertasEnviadas)}}function Pi(n,t){if(n&1){let e=M();o(0,"div",9)(1,"div",10)(2,"button",11),x("click",function(){_(e);let l=p();return v(l.cambiarTab("recibidas"))}),a(3),i(),o(4,"button",11),x("click",function(){_(e);let l=p();return v(l.cambiarTab("enviadas"))}),a(5),i()(),m(6,mi,3,2,"div",12)(7,Ui,3,2,"div",12),i()}if(n&2){let e=p();s(2),Fe("active",e.activeTab==="recibidas"),s(),b(" Ofertas Recibidas (",e.ofertasRecibidas.length,") "),s(),Fe("active",e.activeTab==="enviadas"),s(),b(" Ofertas Enviadas (",e.ofertasEnviadas.length,") "),s(),c("ngIf",e.activeTab==="recibidas"),s(),c("ngIf",e.activeTab==="enviadas")}}var Ue=class n{constructor(t,e,r,l){this.router=t;this.userService=e;this.authService=r;this.apiService=l}currentUserId=null;ofertasRecibidas=[];ofertasEnviadas=[];loading=!0;error=null;activeTab="recibidas";userNames={};loadingNames=new Set;ngOnInit(){return h(this,null,function*(){yield this.setCurrentUserId(),this.currentUserId?this.loadOfertas():(this.error="No se pudo obtener el usuario actual",this.loading=!1)})}setCurrentUserId(){return h(this,null,function*(){let t=this.authService.getUserInfo(),e=t?.email||Array.isArray(t?.emails)&&t.emails[0]||void 0;if(e)try{let r=yield this.userService.getUsuarioIdPorCorreo(e);this.currentUserId=r}catch{this.currentUserId=null}else this.currentUserId=null})}loadOfertas(){this.loading=!0,this.error=null,console.log("Cargando ofertas para userId:",this.currentUserId),this.apiService.getOfertasRecibidas(this.currentUserId).subscribe({next:t=>{this.ofertasRecibidas=t,this.loading=!1,console.log("Ofertas recibidas:",t)},error:t=>{this.error="Error al cargar las ofertas recibidas",this.loading=!1,console.error("Error al cargar ofertas recibidas:",t)}}),this.apiService.getOfertasEnviadas(this.currentUserId).subscribe({next:t=>{this.ofertasEnviadas=t,console.log("Ofertas enviadas:",t)},error:t=>{console.error("Error al cargar ofertas enviadas:",t)}})}aceptarOferta(t){confirm("\xBFEst\xE1s seguro de que quieres aceptar esta oferta de intercambio?")&&this.apiService.aceptarOferta(t).subscribe({next:e=>{alert("Oferta aceptada correctamente. El intercambio est\xE1 en proceso."),this.loadOfertas()},error:e=>{alert(e.error||"Error al aceptar la oferta")}})}rechazarOferta(t){confirm("\xBFEst\xE1s seguro de que quieres rechazar esta oferta de intercambio?")&&this.apiService.rechazarOferta(t).subscribe({next:e=>{alert("Oferta rechazada correctamente."),this.loadOfertas()},error:e=>{alert(e.error||"Error al rechazar la oferta")}})}confirmarIntercambio(t){this.currentUserId&&confirm("\xBFConfirmas que recibiste el producto y el intercambio fue exitoso?")&&this.apiService.confirmarIntercambio(t,this.currentUserId).subscribe({next:()=>{alert("\xA1Intercambio confirmado!"),this.loadOfertas()},error:e=>{alert(e.error||"Error al confirmar el intercambio")}})}revertirIntercambio(t){this.currentUserId&&confirm("\xBFSeguro que quieres revertir el intercambio y devolver el producto a publicado?")&&this.apiService.revertirIntercambio(t,this.currentUserId).subscribe({next:()=>{alert("Intercambio revertido. El producto vuelve a estar publicado."),this.loadOfertas()},error:e=>{alert(e.error||"Error al revertir el intercambio")}})}getEstadoClass(t){switch(t){case"PENDIENTE":return"estado-pendiente";case"ACEPTADO":return"estado-aceptado";case"RECHAZADO":return"estado-rechazado";case"CANCELADO":return"estado-cancelado";default:return"estado-default"}}getEstadoText(t){switch(t){case"PENDIENTE":return"Pendiente";case"ACEPTADO":return"Aceptado";case"RECHAZADO":return"Rechazado";case"CANCELADO":return"Cancelado";default:return t}}formatDate(t){return new Date(t).toLocaleDateString("es-ES",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})}verProducto(t){this.router.navigate(["/producto",t])}cambiarTab(t){this.activeTab=t}getUserNameById(t){return this.userNames[t]?this.userNames[t]:(this.loadingNames.has(t)||(this.loadingNames.add(t),this.userService.getUsuarioPorId(t).then(e=>{e&&e.primerNombre&&e.apellidoPaterno?this.userNames[t]=`${e.primerNombre} ${e.apellidoPaterno}`:e&&e.primerNombre?this.userNames[t]=e.primerNombre:this.userNames[t]="Usuario "+t,this.loadingNames.delete(t)})),"")}static \u0275fac=function(e){return new(e||n)(g(w),g(O),g(I),g(et))};static \u0275cmp=U({type:n,selectors:[["app-intercambios-panel"]],decls:9,vars:3,consts:[["loadingNameSolicitante",""],["loadingNamePropietario",""],[1,"intercambios-panel"],[1,"panel-header"],["class","loading",4,"ngIf"],["class","error",4,"ngIf"],["class","panel-content",4,"ngIf"],[1,"loading"],[1,"error"],[1,"panel-content"],[1,"tabs"],[1,"tab-btn",3,"click"],["class","tab-content",4,"ngIf"],[1,"tab-content"],["class","no-ofertas",4,"ngIf"],["class","oferta-card",4,"ngFor","ngForOf"],[1,"no-ofertas"],[1,"oferta-card"],[1,"oferta-header"],[4,"ngIf","ngIfElse"],[1,"productos-comparison"],[1,"producto-solicitado"],[1,"producto-info"],[3,"src","alt"],[1,"producto-details"],[1,"price"],[1,"intercambio-arrow"],[1,"producto-ofrecido"],[1,"oferta-footer"],[1,"oferta-date"],["class","oferta-actions",4,"ngIf"],["class","oferta-status",4,"ngIf"],[1,"spinner-small"],[1,"oferta-actions"],[1,"btn-aceptar",3,"click"],[1,"btn-rechazar",3,"click"],[1,"oferta-status"],[1,"confirmacion-info"],[4,"ngIf"],[1,"status-wait"],[1,"status-finalizado"],[1,"status-revertido"],[1,"status-rejected"],[1,"status-accepted"],[1,"status-pending"]],template:function(e,r){e&1&&(o(0,"div",2)(1,"div",3)(2,"h2"),a(3,"Panel de Intercambios"),i(),o(4,"p"),a(5,"Gestiona tus ofertas de intercambio"),i()(),m(6,Yt,2,0,"div",4)(7,Xt,2,1,"div",5)(8,Pi,8,8,"div",6),i()),e&2&&(s(6),c("ngIf",r.loading),s(),c("ngIf",r.error),s(),c("ngIf",!r.loading&&!r.error))},dependencies:[F,L,y,ie,Y],styles:[".intercambios-panel[_ngcontent-%COMP%]{max-width:1200px;margin:2rem auto;padding:0 1rem}.panel-header[_ngcontent-%COMP%]{text-align:center;margin-bottom:2rem}.panel-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#1a237e;font-size:2rem;font-weight:700;margin-bottom:.5rem}.panel-header[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#6c757d;font-size:1.1rem}.loading[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6c757d;font-size:1.1rem}.error[_ngcontent-%COMP%]{background:#ffebee;color:#d32f2f;padding:1rem;border-radius:8px;border-left:4px solid #d32f2f;margin-bottom:1rem}.tabs[_ngcontent-%COMP%]{display:flex;gap:.5rem;margin-bottom:2rem;border-bottom:2px solid #e9ecef}.tab-btn[_ngcontent-%COMP%]{background:none;border:none;padding:1rem 1.5rem;font-size:1rem;font-weight:600;color:#6c757d;cursor:pointer;transition:all .3s ease;border-bottom:3px solid transparent}.tab-btn[_ngcontent-%COMP%]:hover{color:#1a237e;background:#f8f9fa}.tab-btn.active[_ngcontent-%COMP%]{color:#1a237e;border-bottom-color:#1a237e;background:#f8f9fa}.tab-content[_ngcontent-%COMP%]{min-height:400px}.no-ofertas[_ngcontent-%COMP%]{text-align:center;padding:3rem;color:#6c757d;font-style:italic;background:#f8f9fa;border-radius:12px;border:2px dashed #dee2e6}.oferta-card[_ngcontent-%COMP%]{background:#fff;border-radius:16px;box-shadow:0 4px 12px #0000001a;margin-bottom:2rem;overflow:hidden;border:1px solid #e9ecef}.oferta-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;padding:1.5rem 2rem;background:#f8f9fa;border-bottom:1px solid #e9ecef}.oferta-header[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{margin:0;color:#1a237e;font-size:1.2rem;font-weight:600}.estado-pendiente[_ngcontent-%COMP%]{background:#fff3cd;color:#856404;padding:.5rem 1rem;border-radius:20px;font-size:.9rem;font-weight:600}.estado-aceptado[_ngcontent-%COMP%]{background:#d4edda;color:#155724;padding:.5rem 1rem;border-radius:20px;font-size:.9rem;font-weight:600}.estado-rechazado[_ngcontent-%COMP%]{background:#f8d7da;color:#721c24;padding:.5rem 1rem;border-radius:20px;font-size:.9rem;font-weight:600}.estado-cancelado[_ngcontent-%COMP%]{background:#e2e3e5;color:#383d41;padding:.5rem 1rem;border-radius:20px;font-size:.9rem;font-weight:600}.productos-comparison[_ngcontent-%COMP%]{display:flex;align-items:center;padding:2rem;gap:2rem}.producto-solicitado[_ngcontent-%COMP%], .producto-ofrecido[_ngcontent-%COMP%]{flex:1;text-align:center}.producto-solicitado[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%], .producto-ofrecido[_ngcontent-%COMP%]   h4[_ngcontent-%COMP%]{margin:0 0 1rem;color:#495057;font-size:1rem;font-weight:600}.producto-info[_ngcontent-%COMP%]{background:#f8f9fa;border-radius:12px;padding:1rem;border:2px solid #e9ecef}.producto-info[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:100%;height:150px;object-fit:cover;border-radius:8px;margin-bottom:1rem}.producto-details[_ngcontent-%COMP%]   h5[_ngcontent-%COMP%]{margin:0 0 .5rem;color:#1a237e;font-size:1rem;font-weight:600}.producto-details[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin:.3rem 0;color:#6c757d;font-size:.9rem;line-height:1.4}.producto-details[_ngcontent-%COMP%]   .price[_ngcontent-%COMP%]{font-weight:600;color:#28a745;font-size:1.1rem;margin-top:.5rem}.intercambio-arrow[_ngcontent-%COMP%]{font-size:2rem;color:#1a237e;font-weight:700;background:#e3f2fd;border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;box-shadow:0 2px 8px #1a237e33}.oferta-footer[_ngcontent-%COMP%]{padding:1.5rem 2rem;background:#f8f9fa;border-top:1px solid #e9ecef;display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:1rem}.oferta-date[_ngcontent-%COMP%]{color:#6c757d;font-size:.9rem}.oferta-actions[_ngcontent-%COMP%]{display:flex;gap:1rem}.btn-aceptar[_ngcontent-%COMP%]{background:#28a745;color:#fff;border:none;border-radius:6px;padding:.7rem 1.2rem;font-size:.95rem;font-weight:600;cursor:pointer;transition:background .2s}.btn-aceptar[_ngcontent-%COMP%]:hover{background:#218838}.btn-rechazar[_ngcontent-%COMP%]{background:#dc3545;color:#fff;border:none;border-radius:6px;padding:.7rem 1.2rem;font-size:.95rem;font-weight:600;cursor:pointer;transition:background .2s}.btn-rechazar[_ngcontent-%COMP%]:hover{background:#c82333}.oferta-status[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:flex-end;gap:.3rem}.status-accepted[_ngcontent-%COMP%]{color:#155724;font-weight:600}.status-rejected[_ngcontent-%COMP%]{color:#721c24;font-weight:600}.status-pending[_ngcontent-%COMP%]{color:#856404;font-weight:600}.oferta-status[_ngcontent-%COMP%]   small[_ngcontent-%COMP%]{color:#6c757d;font-size:.8rem}@media (max-width: 768px){.intercambios-panel[_ngcontent-%COMP%]{margin:1rem auto;padding:0 .5rem}.panel-header[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1.5rem}.tabs[_ngcontent-%COMP%]{flex-direction:column}.tab-btn[_ngcontent-%COMP%]{text-align:center}.productos-comparison[_ngcontent-%COMP%]{flex-direction:column;gap:1rem}.intercambio-arrow[_ngcontent-%COMP%]{transform:rotate(90deg)}.oferta-footer[_ngcontent-%COMP%]{flex-direction:column;align-items:stretch}.oferta-actions[_ngcontent-%COMP%]{justify-content:center}.oferta-status[_ngcontent-%COMP%]{align-items:center}}.spinner-small[_ngcontent-%COMP%]{display:inline-block;width:18px;height:18px;border:2px solid #ccc;border-top:2px solid #1976d2;border-radius:50%;animation:_ngcontent-%COMP%_spin .7s linear infinite;vertical-align:middle}@keyframes _ngcontent-%COMP%_spin{to{transform:rotate(360deg)}}"]})};var nt=[{path:"login",component:ge},{path:"complete-registration",component:_e},{path:"dashboard",component:be,canActivate:[ke],children:[{path:"usuarios",component:ve},{path:"publicar-producto",component:he},{path:"edit-user/:id",loadComponent:()=>import("./chunk-2JLYDJP7.js").then(n=>n.EditUserComponent)},{path:"mis-productos",loadComponent:()=>import("./chunk-GHNONUCZ.js").then(n=>n.UserProductsComponent)},{path:"producto/:id",loadComponent:()=>import("./chunk-CSKTK4NS.js").then(n=>n.ProductViewComponent)},{path:"todos-los-productos",component:Ce},{path:"intercambios",component:Ue},{path:"confirmar-intercambios",canActivate:[ke],loadComponent:()=>import("./chunk-76OW7C7U.js").then(n=>n.ConfirmarIntercambiosComponent)}]},{path:"",redirectTo:"/login",pathMatch:"full"},{path:"**",redirectTo:"/login"}];var ot={auth:{clientId:"22c2ec51-5266-40ca-81fe-b40be13e8a23",authority:"https://proyectouc.b2clogin.com/proyectouc.onmicrosoft.com/B2C_1_UserCreated",redirectUri:P.redirectUri,knownAuthorities:["proyectouc.b2clogin.com"]},cache:{cacheLocation:"localStorage",storeAuthStateInCookie:!1}};function yi(){return new $e(ot)}function Fi(){return h(this,null,function*(){let n=yi();try{yield n.initialize();let t=yield n.handleRedirectPromise();if(t?.account)n.setActiveAccount(t.account),console.log("\u2705 Cuenta activa desde redirect:",t.account);else{let l=n.getAllAccounts();l.length>0?(n.setActiveAccount(l[0]),console.log("\u2705 Cuenta restaurada:",l[0])):(n.setActiveAccount(null),console.warn("\u26A0\uFE0F No hay cuenta activa. Se limpi\xF3 sesi\xF3n previa."))}let r=(yield je(fe,{providers:[Je(nt),He(),{provide:Ge,useValue:n},R]})).injector.get(R);r.msalInstance=n,console.log("\u2705 MSAL inicializado correctamente")}catch(t){console.error("\u274C Error durante inicializaci\xF3n MSAL:",t)}})}Fi();export{yi as MSALInstanceFactory};
